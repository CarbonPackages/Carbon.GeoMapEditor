import"./chunk-UCZBWS2Z.js";var ti=Object.create,Te=Object.defineProperty,ii=Object.getOwnPropertyDescriptor,ri=Object.getOwnPropertyNames,Je=Object.getOwnPropertySymbols,ni=Object.getPrototypeOf,bt=Object.prototype.hasOwnProperty,si=Object.prototype.propertyIsEnumerable,Ge=(e,i,r)=>i in e?Te(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,ai=(e,i)=>{for(var r in i||(i={}))bt.call(i,r)&&Ge(e,r,i[r]);if(Je)for(var r of Je(i))si.call(i,r)&&Ge(e,r,i[r]);return e},oi=e=>Te(e,"__esModule",{value:!0}),te=(e,i)=>function(){return i||(0,e[Object.keys(e)[0]])((i={exports:{}}).exports,i),i.exports},li=(e,i,r)=>{if(i&&typeof i=="object"||typeof i=="function")for(let t of ri(i))!bt.call(e,t)&&t!=="default"&&Te(e,t,{get:()=>i[t],enumerable:!(r=ii(i,t))||r.enumerable});return e},N=e=>li(oi(Te(e!=null?ti(ni(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e),Z=(e,i,r)=>new Promise((t,n)=>{var s=l=>{try{a(r.next(l))}catch(f){n(f)}},o=l=>{try{a(r.throw(l))}catch(f){n(f)}},a=l=>l.done?t(l.value):Promise.resolve(l.value).then(s,o);a((r=r.apply(e,i)).next())}),ne=te({"node_modules/@mapbox/point-geometry/index.js"(e,i){"use strict";i.exports=r;function r(t,n){this.x=t,this.y=n}r.prototype={clone:function(){return new r(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,n){return this.clone()._rotateAround(t,n)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var n=t.x-this.x,s=t.y-this.y;return n*n+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,n){return Math.atan2(this.x*n-this.y*t,this.x*t+this.y*n)},_matMult:function(t){var n=t[0]*this.x+t[1]*this.y,s=t[2]*this.x+t[3]*this.y;return this.x=n,this.y=s,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var n=Math.cos(t),s=Math.sin(t),o=n*this.x-s*this.y,a=s*this.x+n*this.y;return this.x=o,this.y=a,this},_rotateAround:function(t,n){var s=Math.cos(t),o=Math.sin(t),a=n.x+s*(this.x-n.x)-o*(this.y-n.y),l=n.y+o*(this.x-n.x)+s*(this.y-n.y);return this.x=a,this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},r.convert=function(t){return t instanceof r?t:Array.isArray(t)?new r(t[0],t[1]):t}}}),zt=te({"node_modules/@mapbox/vector-tile/lib/vectortilefeature.js"(e,i){"use strict";var r=ne();i.exports=t;function t(l,f,u,c,g){this.properties={},this.extent=u,this.type=0,this._pbf=l,this._geometry=-1,this._keys=c,this._values=g,l.readFields(n,this,f)}function n(l,f,u){l==1?f.id=u.readVarint():l==2?s(u,f):l==3?f.type=u.readVarint():l==4&&(f._geometry=u.pos)}function s(l,f){for(var u=l.readVarint()+l.pos;l.pos<u;){var c=f._keys[l.readVarint()],g=f._values[l.readVarint()];f.properties[c]=g}}t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var l=this._pbf;l.pos=this._geometry;for(var f=l.readVarint()+l.pos,u=1,c=0,g=0,w=0,x=[],_;l.pos<f;){if(c<=0){var M=l.readVarint();u=M&7,c=M>>3}if(c--,u===1||u===2)g+=l.readSVarint(),w+=l.readSVarint(),u===1&&(_&&x.push(_),_=[]),_.push(new r(g,w));else if(u===7)_&&_.push(_[0].clone());else throw new Error("unknown command "+u)}return _&&x.push(_),x},t.prototype.bbox=function(){var l=this._pbf;l.pos=this._geometry;for(var f=l.readVarint()+l.pos,u=1,c=0,g=0,w=0,x=1/0,_=-1/0,M=1/0,S=-1/0;l.pos<f;){if(c<=0){var d=l.readVarint();u=d&7,c=d>>3}if(c--,u===1||u===2)g+=l.readSVarint(),w+=l.readSVarint(),g<x&&(x=g),g>_&&(_=g),w<M&&(M=w),w>S&&(S=w);else if(u!==7)throw new Error("unknown command "+u)}return[x,M,_,S]},t.prototype.toGeoJSON=function(l,f,u){var c=this.extent*Math.pow(2,u),g=this.extent*l,w=this.extent*f,x=this.loadGeometry(),_=t.types[this.type],M,S;function d(z){for(var k=0;k<z.length;k++){var b=z[k],F=180-(b.y+w)*360/c;z[k]=[(b.x+g)*360/c-180,360/Math.PI*Math.atan(Math.exp(F*Math.PI/180))-90]}}switch(this.type){case 1:var m=[];for(M=0;M<x.length;M++)m[M]=x[M][0];x=m,d(x);break;case 2:for(M=0;M<x.length;M++)d(x[M]);break;case 3:for(x=o(x),M=0;M<x.length;M++)for(S=0;S<x[M].length;S++)d(x[M][S]);break}x.length===1?x=x[0]:_="Multi"+_;var y={type:"Feature",geometry:{type:_,coordinates:x},properties:this.properties};return"id"in this&&(y.id=this.id),y};function o(l){var f=l.length;if(f<=1)return[l];for(var u=[],c,g,w=0;w<f;w++){var x=a(l[w]);x!==0&&(g===void 0&&(g=x<0),g===x<0?(c&&u.push(c),c=[l[w]]):c.push(l[w]))}return c&&u.push(c),u}function a(l){for(var f=0,u=0,c=l.length,g=c-1,w,x;u<c;g=u++)w=l[u],x=l[g],f+=(x.x-w.x)*(w.y+x.y);return f}}}),kt=te({"node_modules/@mapbox/vector-tile/lib/vectortilelayer.js"(e,i){"use strict";var r=zt();i.exports=t;function t(o,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(n,this,a),this.length=this._features.length}function n(o,a,l){o===15?a.version=l.readVarint():o===1?a.name=l.readString():o===5?a.extent=l.readVarint():o===2?a._features.push(l.pos):o===3?a._keys.push(l.readString()):o===4&&a._values.push(s(l))}function s(o){for(var a=null,l=o.readVarint()+o.pos;o.pos<l;){var f=o.readVarint()>>3;a=f===1?o.readString():f===2?o.readFloat():f===3?o.readDouble():f===4?o.readVarint64():f===5?o.readVarint():f===6?o.readSVarint():f===7?o.readBoolean():null}return a}t.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var a=this._pbf.readVarint()+this._pbf.pos;return new r(this._pbf,a,this.extent,this._keys,this._values)}}}),hi=te({"node_modules/@mapbox/vector-tile/lib/vectortile.js"(e,i){"use strict";var r=kt();i.exports=t;function t(s,o){this.layers=s.readFields(n,{},o)}function n(s,o,a){if(s===3){var l=new r(a,a.readVarint()+a.pos);l.length&&(o[l.name]=l)}}}}),fi=te({"node_modules/@mapbox/vector-tile/index.js"(e,i){i.exports.VectorTile=hi(),i.exports.VectorTileFeature=zt(),i.exports.VectorTileLayer=kt()}}),ui=te({"node_modules/ieee754/index.js"(e){e.read=function(i,r,t,n,s){var o,a,l=s*8-n-1,f=(1<<l)-1,u=f>>1,c=-7,g=t?s-1:0,w=t?-1:1,x=i[r+g];for(g+=w,o=x&(1<<-c)-1,x>>=-c,c+=l;c>0;o=o*256+i[r+g],g+=w,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;c>0;a=a*256+i[r+g],g+=w,c-=8);if(o===0)o=1-u;else{if(o===f)return a?NaN:(x?-1:1)*(1/0);a=a+Math.pow(2,n),o=o-u}return(x?-1:1)*a*Math.pow(2,o-n)},e.write=function(i,r,t,n,s,o){var a,l,f,u=o*8-s-1,c=(1<<u)-1,g=c>>1,w=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,x=n?0:o-1,_=n?1:-1,M=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(l=isNaN(r)?1:0,a=c):(a=Math.floor(Math.log(r)/Math.LN2),r*(f=Math.pow(2,-a))<1&&(a--,f*=2),a+g>=1?r+=w/f:r+=w*Math.pow(2,1-g),r*f>=2&&(a++,f/=2),a+g>=c?(l=0,a=c):a+g>=1?(l=(r*f-1)*Math.pow(2,s),a=a+g):(l=r*Math.pow(2,g-1)*Math.pow(2,s),a=0));s>=8;i[t+x]=l&255,x+=_,l/=256,s-=8);for(a=a<<s|l,u+=s;u>0;i[t+x]=a&255,x+=_,a/=256,u-=8);i[t+x-_]|=M*128}}}),di=te({"node_modules/pbf/index.js"(e,i){"use strict";i.exports=t;var r=ui();function t(h){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(h)?h:new Uint8Array(h||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var n=65536*65536,s=1/n,o=12,a=typeof TextDecoder>"u"?null:new TextDecoder("utf8");t.prototype={destroy:function(){this.buf=null},readFields:function(h,p,v){for(v=v||this.length;this.pos<v;){var C=this.readVarint(),D=C>>3,E=this.pos;this.type=C&7,h(D,p,this),this.pos===E&&this.skip(C)}return p},readMessage:function(h,p){return this.readFields(h,p,this.readVarint()+this.pos)},readFixed32:function(){var h=F(this.buf,this.pos);return this.pos+=4,h},readSFixed32:function(){var h=B(this.buf,this.pos);return this.pos+=4,h},readFixed64:function(){var h=F(this.buf,this.pos)+F(this.buf,this.pos+4)*n;return this.pos+=8,h},readSFixed64:function(){var h=F(this.buf,this.pos)+B(this.buf,this.pos+4)*n;return this.pos+=8,h},readFloat:function(){var h=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,h},readDouble:function(){var h=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,h},readVarint:function(h){var p=this.buf,v,C;return C=p[this.pos++],v=C&127,C<128||(C=p[this.pos++],v|=(C&127)<<7,C<128)||(C=p[this.pos++],v|=(C&127)<<14,C<128)||(C=p[this.pos++],v|=(C&127)<<21,C<128)?v:(C=p[this.pos],v|=(C&15)<<28,l(v,h,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var h=this.readVarint();return h%2===1?(h+1)/-2:h/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var h=this.readVarint()+this.pos,p=this.pos;return this.pos=h,h-p>=o&&a?I(this.buf,p,h):X(this.buf,p,h)},readBytes:function(){var h=this.readVarint()+this.pos,p=this.buf.subarray(this.pos,h);return this.pos=h,p},readPackedVarint:function(h,p){if(this.type!==t.Bytes)return h.push(this.readVarint(p));var v=f(this);for(h=h||[];this.pos<v;)h.push(this.readVarint(p));return h},readPackedSVarint:function(h){if(this.type!==t.Bytes)return h.push(this.readSVarint());var p=f(this);for(h=h||[];this.pos<p;)h.push(this.readSVarint());return h},readPackedBoolean:function(h){if(this.type!==t.Bytes)return h.push(this.readBoolean());var p=f(this);for(h=h||[];this.pos<p;)h.push(this.readBoolean());return h},readPackedFloat:function(h){if(this.type!==t.Bytes)return h.push(this.readFloat());var p=f(this);for(h=h||[];this.pos<p;)h.push(this.readFloat());return h},readPackedDouble:function(h){if(this.type!==t.Bytes)return h.push(this.readDouble());var p=f(this);for(h=h||[];this.pos<p;)h.push(this.readDouble());return h},readPackedFixed32:function(h){if(this.type!==t.Bytes)return h.push(this.readFixed32());var p=f(this);for(h=h||[];this.pos<p;)h.push(this.readFixed32());return h},readPackedSFixed32:function(h){if(this.type!==t.Bytes)return h.push(this.readSFixed32());var p=f(this);for(h=h||[];this.pos<p;)h.push(this.readSFixed32());return h},readPackedFixed64:function(h){if(this.type!==t.Bytes)return h.push(this.readFixed64());var p=f(this);for(h=h||[];this.pos<p;)h.push(this.readFixed64());return h},readPackedSFixed64:function(h){if(this.type!==t.Bytes)return h.push(this.readSFixed64());var p=f(this);for(h=h||[];this.pos<p;)h.push(this.readSFixed64());return h},skip:function(h){var p=h&7;if(p===t.Varint)for(;this.buf[this.pos++]>127;);else if(p===t.Bytes)this.pos=this.readVarint()+this.pos;else if(p===t.Fixed32)this.pos+=4;else if(p===t.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+p)},writeTag:function(h,p){this.writeVarint(h<<3|p)},realloc:function(h){for(var p=this.length||16;p<this.pos+h;)p*=2;if(p!==this.length){var v=new Uint8Array(p);v.set(this.buf),this.buf=v,this.length=p}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(h){this.realloc(4),T(this.buf,h,this.pos),this.pos+=4},writeSFixed32:function(h){this.realloc(4),T(this.buf,h,this.pos),this.pos+=4},writeFixed64:function(h){this.realloc(8),T(this.buf,h&-1,this.pos),T(this.buf,Math.floor(h*s),this.pos+4),this.pos+=8},writeSFixed64:function(h){this.realloc(8),T(this.buf,h&-1,this.pos),T(this.buf,Math.floor(h*s),this.pos+4),this.pos+=8},writeVarint:function(h){if(h=+h||0,h>268435455||h<0){c(h,this);return}this.realloc(4),this.buf[this.pos++]=h&127|(h>127?128:0),!(h<=127)&&(this.buf[this.pos++]=(h>>>=7)&127|(h>127?128:0),!(h<=127)&&(this.buf[this.pos++]=(h>>>=7)&127|(h>127?128:0),!(h<=127)&&(this.buf[this.pos++]=h>>>7&127)))},writeSVarint:function(h){this.writeVarint(h<0?-h*2-1:h*2)},writeBoolean:function(h){this.writeVarint(!!h)},writeString:function(h){h=String(h),this.realloc(h.length*4),this.pos++;var p=this.pos;this.pos=Y(this.buf,h,this.pos);var v=this.pos-p;v>=128&&x(p,v,this),this.pos=p-1,this.writeVarint(v),this.pos+=v},writeFloat:function(h){this.realloc(4),r.write(this.buf,h,this.pos,!0,23,4),this.pos+=4},writeDouble:function(h){this.realloc(8),r.write(this.buf,h,this.pos,!0,52,8),this.pos+=8},writeBytes:function(h){var p=h.length;this.writeVarint(p),this.realloc(p);for(var v=0;v<p;v++)this.buf[this.pos++]=h[v]},writeRawMessage:function(h,p){this.pos++;var v=this.pos;h(p,this);var C=this.pos-v;C>=128&&x(v,C,this),this.pos=v-1,this.writeVarint(C),this.pos+=C},writeMessage:function(h,p,v){this.writeTag(h,t.Bytes),this.writeRawMessage(p,v)},writePackedVarint:function(h,p){p.length&&this.writeMessage(h,_,p)},writePackedSVarint:function(h,p){p.length&&this.writeMessage(h,M,p)},writePackedBoolean:function(h,p){p.length&&this.writeMessage(h,m,p)},writePackedFloat:function(h,p){p.length&&this.writeMessage(h,S,p)},writePackedDouble:function(h,p){p.length&&this.writeMessage(h,d,p)},writePackedFixed32:function(h,p){p.length&&this.writeMessage(h,y,p)},writePackedSFixed32:function(h,p){p.length&&this.writeMessage(h,z,p)},writePackedFixed64:function(h,p){p.length&&this.writeMessage(h,k,p)},writePackedSFixed64:function(h,p){p.length&&this.writeMessage(h,b,p)},writeBytesField:function(h,p){this.writeTag(h,t.Bytes),this.writeBytes(p)},writeFixed32Field:function(h,p){this.writeTag(h,t.Fixed32),this.writeFixed32(p)},writeSFixed32Field:function(h,p){this.writeTag(h,t.Fixed32),this.writeSFixed32(p)},writeFixed64Field:function(h,p){this.writeTag(h,t.Fixed64),this.writeFixed64(p)},writeSFixed64Field:function(h,p){this.writeTag(h,t.Fixed64),this.writeSFixed64(p)},writeVarintField:function(h,p){this.writeTag(h,t.Varint),this.writeVarint(p)},writeSVarintField:function(h,p){this.writeTag(h,t.Varint),this.writeSVarint(p)},writeStringField:function(h,p){this.writeTag(h,t.Bytes),this.writeString(p)},writeFloatField:function(h,p){this.writeTag(h,t.Fixed32),this.writeFloat(p)},writeDoubleField:function(h,p){this.writeTag(h,t.Fixed64),this.writeDouble(p)},writeBooleanField:function(h,p){this.writeVarintField(h,!!p)}};function l(h,p,v){var C=v.buf,D,E;if(E=C[v.pos++],D=(E&112)>>4,E<128||(E=C[v.pos++],D|=(E&127)<<3,E<128)||(E=C[v.pos++],D|=(E&127)<<10,E<128)||(E=C[v.pos++],D|=(E&127)<<17,E<128)||(E=C[v.pos++],D|=(E&127)<<24,E<128)||(E=C[v.pos++],D|=(E&1)<<31,E<128))return u(h,D,p);throw new Error("Expected varint not more than 10 bytes")}function f(h){return h.type===t.Bytes?h.readVarint()+h.pos:h.pos+1}function u(h,p,v){return v?p*4294967296+(h>>>0):(p>>>0)*4294967296+(h>>>0)}function c(h,p){var v,C;if(h>=0?(v=h%4294967296|0,C=h/4294967296|0):(v=~(-h%4294967296),C=~(-h/4294967296),v^4294967295?v=v+1|0:(v=0,C=C+1|0)),h>=18446744073709552e3||h<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");p.realloc(10),g(v,C,p),w(C,p)}function g(h,p,v){v.buf[v.pos++]=h&127|128,h>>>=7,v.buf[v.pos++]=h&127|128,h>>>=7,v.buf[v.pos++]=h&127|128,h>>>=7,v.buf[v.pos++]=h&127|128,h>>>=7,v.buf[v.pos]=h&127}function w(h,p){var v=(h&7)<<4;p.buf[p.pos++]|=v|((h>>>=3)?128:0),h&&(p.buf[p.pos++]=h&127|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=h&127|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=h&127|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=h&127|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=h&127)))))}function x(h,p,v){var C=p<=16383?1:p<=2097151?2:p<=268435455?3:Math.floor(Math.log(p)/(Math.LN2*7));v.realloc(C);for(var D=v.pos-1;D>=h;D--)v.buf[D+C]=v.buf[D]}function _(h,p){for(var v=0;v<h.length;v++)p.writeVarint(h[v])}function M(h,p){for(var v=0;v<h.length;v++)p.writeSVarint(h[v])}function S(h,p){for(var v=0;v<h.length;v++)p.writeFloat(h[v])}function d(h,p){for(var v=0;v<h.length;v++)p.writeDouble(h[v])}function m(h,p){for(var v=0;v<h.length;v++)p.writeBoolean(h[v])}function y(h,p){for(var v=0;v<h.length;v++)p.writeFixed32(h[v])}function z(h,p){for(var v=0;v<h.length;v++)p.writeSFixed32(h[v])}function k(h,p){for(var v=0;v<h.length;v++)p.writeFixed64(h[v])}function b(h,p){for(var v=0;v<h.length;v++)p.writeSFixed64(h[v])}function F(h,p){return(h[p]|h[p+1]<<8|h[p+2]<<16)+h[p+3]*16777216}function T(h,p,v){h[v]=p,h[v+1]=p>>>8,h[v+2]=p>>>16,h[v+3]=p>>>24}function B(h,p){return(h[p]|h[p+1]<<8|h[p+2]<<16)+(h[p+3]<<24)}function X(h,p,v){for(var C="",D=p;D<v;){var E=h[D],P=null,O=E>239?4:E>223?3:E>191?2:1;if(D+O>v)break;var A,ie,ae;O===1?E<128&&(P=E):O===2?(A=h[D+1],(A&192)===128&&(P=(E&31)<<6|A&63,P<=127&&(P=null))):O===3?(A=h[D+1],ie=h[D+2],(A&192)===128&&(ie&192)===128&&(P=(E&15)<<12|(A&63)<<6|ie&63,(P<=2047||P>=55296&&P<=57343)&&(P=null))):O===4&&(A=h[D+1],ie=h[D+2],ae=h[D+3],(A&192)===128&&(ie&192)===128&&(ae&192)===128&&(P=(E&15)<<18|(A&63)<<12|(ie&63)<<6|ae&63,(P<=65535||P>=1114112)&&(P=null))),P===null?(P=65533,O=1):P>65535&&(P-=65536,C+=String.fromCharCode(P>>>10&1023|55296),P=56320|P&1023),C+=String.fromCharCode(P),D+=O}return C}function I(h,p,v){return a.decode(h.subarray(p,v))}function Y(h,p,v){for(var C=0,D,E;C<p.length;C++){if(D=p.charCodeAt(C),D>55295&&D<57344)if(E)if(D<56320){h[v++]=239,h[v++]=191,h[v++]=189,E=D;continue}else D=E-55296<<10|D-56320|65536,E=null;else{D>56319||C+1===p.length?(h[v++]=239,h[v++]=191,h[v++]=189):E=D;continue}else E&&(h[v++]=239,h[v++]=191,h[v++]=189,E=null);D<128?h[v++]=D:(D<2048?h[v++]=D>>6|192:(D<65536?h[v++]=D>>12|224:(h[v++]=D>>18|240,h[v++]=D>>12&63|128),h[v++]=D>>6&63|128),h[v++]=D&63|128)}return v}}}),ci=te({"node_modules/rbush/rbush.min.js"(e,i){(function(r,t){typeof e=="object"&&typeof i<"u"?i.exports=t():typeof define=="function"&&define.amd?define(t):(r=r||self).RBush=t()})(e,function(){"use strict";function r(d,m,y,z,k){(function b(F,T,B,X,I){for(;X>B;){if(X-B>600){var Y=X-B+1,h=T-B+1,p=Math.log(Y),v=.5*Math.exp(2*p/3),C=.5*Math.sqrt(p*v*(Y-v)/Y)*(h-Y/2<0?-1:1),D=Math.max(B,Math.floor(T-h*v/Y+C)),E=Math.min(X,Math.floor(T+(Y-h)*v/Y+C));b(F,T,D,E,I)}var P=F[T],O=B,A=X;for(t(F,B,T),I(F[X],P)>0&&t(F,B,X);O<A;){for(t(F,O,A),O++,A--;I(F[O],P)<0;)O++;for(;I(F[A],P)>0;)A--}I(F[B],P)===0?t(F,B,A):t(F,++A,X),A<=T&&(B=A+1),T<=A&&(X=A-1)}})(d,m,y||0,z||d.length-1,k||n)}function t(d,m,y){var z=d[m];d[m]=d[y],d[y]=z}function n(d,m){return d<m?-1:d>m?1:0}var s=function(d){d===void 0&&(d=9),this._maxEntries=Math.max(4,d),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function o(d,m,y){if(!y)return m.indexOf(d);for(var z=0;z<m.length;z++)if(y(d,m[z]))return z;return-1}function a(d,m){l(d,0,d.children.length,m,d)}function l(d,m,y,z,k){k||(k=M(null)),k.minX=1/0,k.minY=1/0,k.maxX=-1/0,k.maxY=-1/0;for(var b=m;b<y;b++){var F=d.children[b];f(k,d.leaf?z(F):F)}return k}function f(d,m){return d.minX=Math.min(d.minX,m.minX),d.minY=Math.min(d.minY,m.minY),d.maxX=Math.max(d.maxX,m.maxX),d.maxY=Math.max(d.maxY,m.maxY),d}function u(d,m){return d.minX-m.minX}function c(d,m){return d.minY-m.minY}function g(d){return(d.maxX-d.minX)*(d.maxY-d.minY)}function w(d){return d.maxX-d.minX+(d.maxY-d.minY)}function x(d,m){return d.minX<=m.minX&&d.minY<=m.minY&&m.maxX<=d.maxX&&m.maxY<=d.maxY}function _(d,m){return m.minX<=d.maxX&&m.minY<=d.maxY&&m.maxX>=d.minX&&m.maxY>=d.minY}function M(d){return{children:d,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function S(d,m,y,z,k){for(var b=[m,y];b.length;)if(!((y=b.pop())-(m=b.pop())<=z)){var F=m+Math.ceil((y-m)/z/2)*z;r(d,F,m,y,k),b.push(m,F,F,y)}}return s.prototype.all=function(){return this._all(this.data,[])},s.prototype.search=function(d){var m=this.data,y=[];if(!_(d,m))return y;for(var z=this.toBBox,k=[];m;){for(var b=0;b<m.children.length;b++){var F=m.children[b],T=m.leaf?z(F):F;_(d,T)&&(m.leaf?y.push(F):x(d,T)?this._all(F,y):k.push(F))}m=k.pop()}return y},s.prototype.collides=function(d){var m=this.data;if(!_(d,m))return!1;for(var y=[];m;){for(var z=0;z<m.children.length;z++){var k=m.children[z],b=m.leaf?this.toBBox(k):k;if(_(d,b)){if(m.leaf||x(d,b))return!0;y.push(k)}}m=y.pop()}return!1},s.prototype.load=function(d){if(!d||!d.length)return this;if(d.length<this._minEntries){for(var m=0;m<d.length;m++)this.insert(d[m]);return this}var y=this._build(d.slice(),0,d.length-1,0);if(this.data.children.length)if(this.data.height===y.height)this._splitRoot(this.data,y);else{if(this.data.height<y.height){var z=this.data;this.data=y,y=z}this._insert(y,this.data.height-y.height-1,!0)}else this.data=y;return this},s.prototype.insert=function(d){return d&&this._insert(d,this.data.height-1),this},s.prototype.clear=function(){return this.data=M([]),this},s.prototype.remove=function(d,m){if(!d)return this;for(var y,z,k,b=this.data,F=this.toBBox(d),T=[],B=[];b||T.length;){if(b||(b=T.pop(),z=T[T.length-1],y=B.pop(),k=!0),b.leaf){var X=o(d,b.children,m);if(X!==-1)return b.children.splice(X,1),T.push(b),this._condense(T),this}k||b.leaf||!x(b,F)?z?(y++,b=z.children[y],k=!1):b=null:(T.push(b),B.push(y),y=0,z=b,b=b.children[0])}return this},s.prototype.toBBox=function(d){return d},s.prototype.compareMinX=function(d,m){return d.minX-m.minX},s.prototype.compareMinY=function(d,m){return d.minY-m.minY},s.prototype.toJSON=function(){return this.data},s.prototype.fromJSON=function(d){return this.data=d,this},s.prototype._all=function(d,m){for(var y=[];d;)d.leaf?m.push.apply(m,d.children):y.push.apply(y,d.children),d=y.pop();return m},s.prototype._build=function(d,m,y,z){var k,b=y-m+1,F=this._maxEntries;if(b<=F)return a(k=M(d.slice(m,y+1)),this.toBBox),k;z||(z=Math.ceil(Math.log(b)/Math.log(F)),F=Math.ceil(b/Math.pow(F,z-1))),(k=M([])).leaf=!1,k.height=z;var T=Math.ceil(b/F),B=T*Math.ceil(Math.sqrt(F));S(d,m,y,B,this.compareMinX);for(var X=m;X<=y;X+=B){var I=Math.min(X+B-1,y);S(d,X,I,T,this.compareMinY);for(var Y=X;Y<=I;Y+=T){var h=Math.min(Y+T-1,I);k.children.push(this._build(d,Y,h,z-1))}}return a(k,this.toBBox),k},s.prototype._chooseSubtree=function(d,m,y,z){for(;z.push(m),!m.leaf&&z.length-1!==y;){for(var k=1/0,b=1/0,F=void 0,T=0;T<m.children.length;T++){var B=m.children[T],X=g(B),I=(Y=d,h=B,(Math.max(h.maxX,Y.maxX)-Math.min(h.minX,Y.minX))*(Math.max(h.maxY,Y.maxY)-Math.min(h.minY,Y.minY))-X);I<b?(b=I,k=X<k?X:k,F=B):I===b&&X<k&&(k=X,F=B)}m=F||m.children[0]}var Y,h;return m},s.prototype._insert=function(d,m,y){var z=y?d:this.toBBox(d),k=[],b=this._chooseSubtree(z,this.data,m,k);for(b.children.push(d),f(b,z);m>=0&&k[m].children.length>this._maxEntries;)this._split(k,m),m--;this._adjustParentBBoxes(z,k,m)},s.prototype._split=function(d,m){var y=d[m],z=y.children.length,k=this._minEntries;this._chooseSplitAxis(y,k,z);var b=this._chooseSplitIndex(y,k,z),F=M(y.children.splice(b,y.children.length-b));F.height=y.height,F.leaf=y.leaf,a(y,this.toBBox),a(F,this.toBBox),m?d[m-1].children.push(F):this._splitRoot(y,F)},s.prototype._splitRoot=function(d,m){this.data=M([d,m]),this.data.height=d.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},s.prototype._chooseSplitIndex=function(d,m,y){for(var z,k,b,F,T,B,X,I=1/0,Y=1/0,h=m;h<=y-m;h++){var p=l(d,0,h,this.toBBox),v=l(d,h,y,this.toBBox),C=(k=p,b=v,F=void 0,T=void 0,B=void 0,X=void 0,F=Math.max(k.minX,b.minX),T=Math.max(k.minY,b.minY),B=Math.min(k.maxX,b.maxX),X=Math.min(k.maxY,b.maxY),Math.max(0,B-F)*Math.max(0,X-T)),D=g(p)+g(v);C<I?(I=C,z=h,Y=D<Y?D:Y):C===I&&D<Y&&(Y=D,z=h)}return z||y-m},s.prototype._chooseSplitAxis=function(d,m,y){var z=d.leaf?this.compareMinX:u,k=d.leaf?this.compareMinY:c;this._allDistMargin(d,m,y,z)<this._allDistMargin(d,m,y,k)&&d.children.sort(z)},s.prototype._allDistMargin=function(d,m,y,z){d.children.sort(z);for(var k=this.toBBox,b=l(d,0,m,k),F=l(d,y-m,y,k),T=w(b)+w(F),B=m;B<y-m;B++){var X=d.children[B];f(b,d.leaf?k(X):X),T+=w(b)}for(var I=y-m-1;I>=m;I--){var Y=d.children[I];f(F,d.leaf?k(Y):Y),T+=w(F)}return T},s.prototype._adjustParentBBoxes=function(d,m,y){for(var z=y;z>=0;z--)f(m[z],d)},s.prototype._condense=function(d){for(var m=d.length-1,y=void 0;m>=0;m--)d[m].children.length===0?m>0?(y=d[m-1].children).splice(y.indexOf(d[m]),1):this.clear():a(d[m],this.toBBox)},s})}}),pi=te({"src/types/unitbezier.d.ts"(){}}),mi=te({"node_modules/tinyqueue/tinyqueue.js"(e,i){(function(r,t){typeof e=="object"&&typeof i<"u"?i.exports=t():typeof define=="function"&&define.amd?define(t):(r=r||self,r.TinyQueue=t())})(e,function(){"use strict";var r=function(s,o){if(s===void 0&&(s=[]),o===void 0&&(o=t),this.data=s,this.length=this.data.length,this.compare=o,this.length>0)for(var a=(this.length>>1)-1;a>=0;a--)this._down(a)};r.prototype.push=function(s){this.data.push(s),this.length++,this._up(this.length-1)},r.prototype.pop=function(){if(this.length!==0){var s=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),s}},r.prototype.peek=function(){return this.data[0]},r.prototype._up=function(s){for(var o=this,a=o.data,l=o.compare,f=a[s];s>0;){var u=s-1>>1,c=a[u];if(l(f,c)>=0)break;a[s]=c,s=u}a[s]=f},r.prototype._down=function(s){for(var o=this,a=o.data,l=o.compare,f=this.length>>1,u=a[s];s<f;){var c=(s<<1)+1,g=a[c],w=c+1;if(w<this.length&&l(a[w],g)<0&&(c=w,g=a[w]),l(g,u)>=0)break;a[s]=g,s=c}a[s]=u};function t(n,s){return n<s?-1:n>s?1:0}return r})}}),yi=te({"node_modules/polylabel/polylabel.js"(e,i){"use strict";var r=mi();r.default&&(r=r.default),i.exports=t,i.exports.default=t;function t(f,u,c){u=u||1;for(var g,w,x,_,M=0;M<f[0].length;M++){var S=f[0][M];(!M||S[0]<g)&&(g=S[0]),(!M||S[1]<w)&&(w=S[1]),(!M||S[0]>x)&&(x=S[0]),(!M||S[1]>_)&&(_=S[1])}var d=x-g,m=_-w,y=Math.min(d,m),z=y/2;if(y===0){var k=[g,w];return k.distance=0,k}for(var b=new r(void 0,n),F=g;F<x;F+=y)for(var T=w;T<_;T+=y)b.push(new s(F+z,T+z,z,f));var B=a(f),X=new s(g+d/2,w+m/2,0,f);X.d>B.d&&(B=X);for(var I=b.length;b.length;){var Y=b.pop();Y.d>B.d&&(B=Y,c&&console.log("found best %d after %d probes",Math.round(1e4*Y.d)/1e4,I)),!(Y.max-B.d<=u)&&(z=Y.h/2,b.push(new s(Y.x-z,Y.y-z,z,f)),b.push(new s(Y.x+z,Y.y-z,z,f)),b.push(new s(Y.x-z,Y.y+z,z,f)),b.push(new s(Y.x+z,Y.y+z,z,f)),I+=4)}c&&(console.log("num probes: "+I),console.log("best distance: "+B.d));var h=[B.x,B.y];return h.distance=B.d,h}function n(f,u){return u.max-f.max}function s(f,u,c,g){this.x=f,this.y=u,this.h=c,this.d=o(f,u,g),this.max=this.d+this.h*Math.SQRT2}function o(f,u,c){for(var g=!1,w=1/0,x=0;x<c.length;x++)for(var _=c[x],M=0,S=_.length,d=S-1;M<S;d=M++){var m=_[M],y=_[d];m[1]>u!=y[1]>u&&f<(y[0]-m[0])*(u-m[1])/(y[1]-m[1])+m[0]&&(g=!g),w=Math.min(w,l(f,u,m,y))}return w===0?0:(g?1:-1)*Math.sqrt(w)}function a(f){for(var u=0,c=0,g=0,w=f[0],x=0,_=w.length,M=_-1;x<_;M=x++){var S=w[x],d=w[M],m=S[0]*d[1]-d[0]*S[1];c+=(S[0]+d[0])*m,g+=(S[1]+d[1])*m,u+=m*3}return u===0?new s(w[0][0],w[0][1],0,f):new s(c/u,g/u,0,f)}function l(f,u,c,g){var w=c[0],x=c[1],_=g[0]-w,M=g[1]-x;if(_!==0||M!==0){var S=((f-w)*_+(u-x)*M)/(_*_+M*M);S>1?(w=g[0],x=g[1]):S>0&&(w+=_*S,x+=M*S)}return _=f-w,M=u-x,_*_+M*M}}}),se=N(ne()),he=N(ne()),we=N(ne()),gi=N(fi()),vi=N(di()),U=(e,i,r)=>new Promise((t,n)=>{var s=l=>{try{a(r.next(l))}catch(f){n(f)}},o=l=>{try{a(r.throw(l))}catch(f){n(f)}},a=l=>l.done?t(l.value):Promise.resolve(l.value).then(s,o);a((r=r.apply(e,i)).next())}),$=Uint8Array,oe=Uint16Array,Mt=Uint32Array,Ft=new $([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Lt=new $([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),wi=new $([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),St=function(e,i){for(var r=new oe(31),t=0;t<31;++t)r[t]=i+=1<<e[t-1];for(var n=new Mt(r[30]),t=1;t<30;++t)for(var s=r[t];s<r[t+1];++s)n[s]=s-r[t]<<5|t;return[r,n]},Dt=St(Ft,2),Ct=Dt[0],xi=Dt[1];Ct[28]=258,xi[258]=28;var Tt=St(Lt,0),_i=Tt[0],Ur=Tt[1],Xe=new oe(32768);for(V=0;V<32768;++V)re=(V&43690)>>>1|(V&21845)<<1,re=(re&52428)>>>2|(re&13107)<<2,re=(re&61680)>>>4|(re&3855)<<4,Xe[V]=((re&65280)>>>8|(re&255)<<8)>>>1;var re,V,ge=function(e,i,r){for(var t=e.length,n=0,s=new oe(i);n<t;++n)e[n]&&++s[e[n]-1];var o=new oe(i);for(n=0;n<i;++n)o[n]=o[n-1]+s[n-1]<<1;var a;if(r){a=new oe(1<<i);var l=15-i;for(n=0;n<t;++n)if(e[n])for(var f=n<<4|e[n],u=i-e[n],c=o[e[n]-1]++<<u,g=c|(1<<u)-1;c<=g;++c)a[Xe[c]>>>l]=f}else for(a=new oe(t),n=0;n<t;++n)e[n]&&(a[n]=Xe[o[e[n]-1]++]>>>15-e[n]);return a},be=new $(288);for(V=0;V<144;++V)be[V]=8;var V;for(V=144;V<256;++V)be[V]=9;var V;for(V=256;V<280;++V)be[V]=7;var V;for(V=280;V<288;++V)be[V]=8;var V,Bt=new $(32);for(V=0;V<32;++V)Bt[V]=5;var V,bi=ge(be,9,1),zi=ge(Bt,5,1),Be=function(e){for(var i=e[0],r=1;r<e.length;++r)e[r]>i&&(i=e[r]);return i},J=function(e,i,r){var t=i/8|0;return(e[t]|e[t+1]<<8)>>(i&7)&r},Ye=function(e,i){var r=i/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(i&7)},ki=function(e){return(e+7)/8|0},Mi=function(e,i,r){(i==null||i<0)&&(i=0),(r==null||r>e.length)&&(r=e.length);var t=new(e.BYTES_PER_ELEMENT==2?oe:e.BYTES_PER_ELEMENT==4?Mt:$)(r-i);return t.set(e.subarray(i,r)),t},Fi=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ee=function(e,i,r){var t=new Error(i||Fi[e]);if(t.code=e,Error.captureStackTrace&&Error.captureStackTrace(t,ee),!r)throw t;return t},Ue=function(e,i,r){var t=e.length;if(!t||r&&r.f&&!r.l)return i||new $(0);var n=!i||r,s=!r||r.i;r||(r={}),i||(i=new $(t*3));var o=function(Ze){var He=i.length;if(Ze>He){var Ke=new $(Math.max(He*2,Ze));Ke.set(i),i=Ke}},a=r.f||0,l=r.p||0,f=r.b||0,u=r.l,c=r.d,g=r.m,w=r.n,x=t*8;do{if(!u){a=J(e,l,1);var _=J(e,l+1,3);if(l+=3,_)if(_==1)u=bi,c=zi,g=9,w=5;else if(_==2){var m=J(e,l,31)+257,y=J(e,l+10,15)+4,z=m+J(e,l+5,31)+1;l+=14;for(var k=new $(z),b=new $(19),F=0;F<y;++F)b[wi[F]]=J(e,l+F*3,7);l+=y*3;for(var T=Be(b),B=(1<<T)-1,X=ge(b,T,1),F=0;F<z;){var I=X[J(e,l,B)];l+=I&15;var M=I>>>4;if(M<16)k[F++]=M;else{var Y=0,h=0;for(M==16?(h=3+J(e,l,3),l+=2,Y=k[F-1]):M==17?(h=3+J(e,l,7),l+=3):M==18&&(h=11+J(e,l,127),l+=7);h--;)k[F++]=Y}}var p=k.subarray(0,m),v=k.subarray(m);g=Be(p),w=Be(v),u=ge(p,g,1),c=ge(v,w,1)}else ee(1);else{var M=ki(l)+4,S=e[M-4]|e[M-3]<<8,d=M+S;if(d>t){s&&ee(0);break}n&&o(f+S),i.set(e.subarray(M,d),f),r.b=f+=S,r.p=l=d*8,r.f=a;continue}if(l>x){s&&ee(0);break}}n&&o(f+131072);for(var C=(1<<g)-1,D=(1<<w)-1,E=l;;E=l){var Y=u[Ye(e,l)&C],P=Y>>>4;if(l+=Y&15,l>x){s&&ee(0);break}if(Y||ee(2),P<256)i[f++]=P;else if(P==256){E=l,u=null;break}else{var O=P-254;if(P>264){var F=P-257,A=Ft[F];O=J(e,l,(1<<A)-1)+Ct[F],l+=A}var ie=c[Ye(e,l)&D],ae=ie>>>4;ie||ee(3),l+=ie&15;var v=_i[ae];if(ae>3){var A=Lt[ae];v+=Ye(e,l)&(1<<A)-1,l+=A}if(l>x){s&&ee(0);break}n&&o(f+131072);for(var We=f+O;f<We;f+=4)i[f]=i[f-v],i[f+1]=i[f+1-v],i[f+2]=i[f+2-v],i[f+3]=i[f+3-v];f=We}}r.l=u,r.p=E,r.b=f,r.f=a,u&&(a=1,r.m=g,r.d=c,r.n=w)}while(!a);return f==i.length?i:Mi(i,0,f)},Li=new $(0),Si=function(e){(e[0]!=31||e[1]!=139||e[2]!=8)&&ee(6,"invalid gzip data");var i=e[3],r=10;i&4&&(r+=e[10]|(e[11]<<8)+2);for(var t=(i>>3&1)+(i>>4&1);t>0;t-=!e[r++]);return r+(i&2)},Di=function(e){var i=e.length;return(e[i-4]|e[i-3]<<8|e[i-2]<<16|e[i-1]<<24)>>>0},Ci=function(e){((e[0]&15)!=8||e[0]>>>4>7||(e[0]<<8|e[1])%31)&&ee(6,"invalid zlib data"),e[1]&32&&ee(6,"invalid zlib data: preset dictionaries not supported")};function Ti(e,i){return Ue(e,i)}function Bi(e,i){return Ue(e.subarray(Si(e),-8),i||new $(Di(e)))}function Yi(e,i){return Ue((Ci(e),e.subarray(2,-4)),i)}function Pe(e,i){return e[0]==31&&e[1]==139&&e[2]==8?Bi(e,i):(e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31?Ti(e,i):Yi(e,i)}var Ei=typeof TextDecoder<"u"&&new TextDecoder,Xi=0;try{Ei.decode(Li,{stream:!0}),Xi=1}catch{}var Yt=(e,i)=>e*Math.pow(2,i),pe=(e,i)=>Math.floor(e/Math.pow(2,i)),De=(e,i)=>Yt(e.getUint16(i+1,!0),8)+e.getUint8(i),Et=(e,i)=>Yt(e.getUint32(i+2,!0),16)+e.getUint16(i,!0),Pi=(e,i,r,t,n)=>{if(e!=t.getUint8(n))return e-t.getUint8(n);let s=De(t,n+1);if(i!=s)return i-s;let o=De(t,n+4);return r!=o?r-o:0},Vi=(e,i,r,t)=>{let n=Xt(e,i|128,r,t);return n?{z:i,x:r,y:t,offset:n[0],length:n[1],is_dir:!0}:null},Qe=(e,i,r,t)=>{let n=Xt(e,i,r,t);return n?{z:i,x:r,y:t,offset:n[0],length:n[1],is_dir:!1}:null},Xt=(e,i,r,t)=>{let n=0,s=e.byteLength/17-1;for(;n<=s;){let o=s+n>>1,a=Pi(i,r,t,e,o*17);if(a>0)n=o+1;else if(a<0)s=o-1;else return[Et(e,o*17+7),e.getUint32(o*17+13,!0)]}return null},Ii=(e,i)=>e.is_dir&&!i.is_dir?1:!e.is_dir&&i.is_dir?-1:e.z!==i.z?e.z-i.z:e.x!==i.x?e.x-i.x:e.y-i.y,Pt=(e,i)=>{let r=e.getUint8(i*17);return{z:r&127,x:De(e,i*17+1),y:De(e,i*17+4),offset:Et(e,i*17+7),length:e.getUint32(i*17+13,!0),is_dir:r>>7===1}},et=e=>{let i=[],r=new DataView(e);for(let t=0;t<r.byteLength/17;t++)i.push(Pt(r,t));return Ai(i)},Ai=e=>{e.sort(Ii);let i=new ArrayBuffer(17*e.length),r=new Uint8Array(i);for(let t=0;t<e.length;t++){let n=e[t],s=n.z;n.is_dir&&(s=s|128),r[t*17]=s,r[t*17+1]=n.x&255,r[t*17+2]=n.x>>8&255,r[t*17+3]=n.x>>16&255,r[t*17+4]=n.y&255,r[t*17+5]=n.y>>8&255,r[t*17+6]=n.y>>16&255,r[t*17+7]=n.offset&255,r[t*17+8]=pe(n.offset,8)&255,r[t*17+9]=pe(n.offset,16)&255,r[t*17+10]=pe(n.offset,24)&255,r[t*17+11]=pe(n.offset,32)&255,r[t*17+12]=pe(n.offset,48)&255,r[t*17+13]=n.length&255,r[t*17+14]=n.length>>8&255,r[t*17+15]=n.length>>16&255,r[t*17+16]=n.length>>24&255}return i},Ri=(e,i)=>{if(e.byteLength<17)return null;let r=e.byteLength/17,t=Pt(e,r-1);if(t.is_dir){let n=t.z,s=i.z-n,o=Math.trunc(i.x/(1<<s)),a=Math.trunc(i.y/(1<<s));return{z:n,x:o,y:a}}return null};function ji(e){return U(this,null,function*(){let i=yield e.getBytes(0,512e3),r=new DataView(i.data),t=r.getUint32(4,!0),n=r.getUint16(8,!0),s=new TextDecoder("utf-8"),o=JSON.parse(s.decode(new DataView(i.data,10,t))),a=0;o.compression==="gzip"&&(a=2);let l=0;"minzoom"in o&&(l=+o.minzoom);let f=0;"maxzoom"in o&&(f=+o.maxzoom);let u=0,c=0,g=0,w=-180,x=-85,_=180,M=85;if(o.bounds){let d=o.bounds.split(",");w=+d[0],x=+d[1],_=+d[2],M=+d[3]}if(o.center){let d=o.center.split(",");u=+d[0],c=+d[1],g=+d[2]}return{specVersion:r.getUint16(2,!0),rootDirectoryOffset:10+t,rootDirectoryLength:n*17,jsonMetadataOffset:10,jsonMetadataLength:t,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:l,maxZoom:f,minLon:w,minLat:x,maxLon:_,maxLat:M,centerZoom:g,centerLon:u,centerLat:c,etag:i.etag}})}function Oi(e,i,r,t,n,s,o){return U(this,null,function*(){let a=yield r.getArrayBuffer(i,e.rootDirectoryOffset,e.rootDirectoryLength,e);e.specVersion===1&&(a=et(a));let l=Qe(new DataView(a),t,n,s);if(l){let c=(yield i.getBytes(l.offset,l.length,o)).data,g=new DataView(c);return g.getUint8(0)==31&&g.getUint8(1)==139&&(c=Pe(new Uint8Array(c))),{data:c}}let f=Ri(new DataView(a),{z:t,x:n,y:s});if(f){let u=Vi(new DataView(a),f.z,f.x,f.y);if(u){let c=yield r.getArrayBuffer(i,u.offset,u.length,e);e.specVersion===1&&(c=et(c));let g=Qe(new DataView(c),t,n,s);if(g){let x=(yield i.getBytes(g.offset,g.length,o)).data,_=new DataView(x);return _.getUint8(0)==31&&_.getUint8(1)==139&&(x=Pe(new Uint8Array(x))),{data:x}}}}})}var Vt={getHeader:ji,getZxy:Oi};function fe(e,i){return(i>>>0)*4294967296+(e>>>0)}function Ui(e,i){let r=i.buf,t,n;if(n=r[i.pos++],t=(n&112)>>4,n<128||(n=r[i.pos++],t|=(n&127)<<3,n<128)||(n=r[i.pos++],t|=(n&127)<<10,n<128)||(n=r[i.pos++],t|=(n&127)<<17,n<128)||(n=r[i.pos++],t|=(n&127)<<24,n<128)||(n=r[i.pos++],t|=(n&1)<<31,n<128))return fe(e,t);throw new Error("Expected varint not more than 10 bytes")}function me(e){let i=e.buf,r,t;return t=i[e.pos++],r=t&127,t<128||(t=i[e.pos++],r|=(t&127)<<7,t<128)||(t=i[e.pos++],r|=(t&127)<<14,t<128)||(t=i[e.pos++],r|=(t&127)<<21,t<128)?r:(t=i[e.pos],r|=(t&15)<<28,Ui(r,e))}function qi(e,i,r,t){if(t==0){r==1&&(i[0]=e-1-i[0],i[1]=e-1-i[1]);let n=i[0];i[0]=i[1],i[1]=n}}function $i(e,i,r){if(e>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(i>Math.pow(2,e)-1||r>Math.pow(2,e)-1)throw Error("tile x/y outside zoom level bounds");let t=0,n=0;for(;n<e;)t+=Math.pow(2,n)*Math.pow(2,n),n++;let s=Math.pow(2,e),o=0,a=0,l=0,f=[i,r],u=s/2;for(;u>0;)o=(f[0]&u)>0?1:0,a=(f[1]&u)>0?1:0,l+=u*u*(3*o^a),qi(u,f,o,a),u=u/2;return t+l}function It(e,i){return U(this,null,function*(){if(i===1||i===0)return e;if(i===2)return Pe(new Uint8Array(e));throw Error("Compression method not supported")})}var Ni=127;function Wi(e,i){let r=0,t=e.length-1;for(;r<=t;){let n=t+r>>1,s=i-e[n].tileId;if(s>0)r=n+1;else if(s<0)t=n-1;else return e[n]}return t>=0&&(e[t].runLength===0||i-e[t].tileId<e[t].runLength)?e[t]:null}var Zi=class{constructor(e){this.url=e}getKey(){return this.url}getBytes(e,i,r){return U(this,null,function*(){let t;r||(t=new AbortController,r=t.signal);let n=yield fetch(this.url,{signal:r,headers:{Range:"bytes="+e+"-"+(e+i-1)}});if(n.status===416&&e===0){let a=n.headers.get("Content-Range");if(!a||!a.startsWith("bytes */"))throw Error("Missing content-length on 416 response");let l=+a.substr(8);n=yield fetch(this.url,{signal:r,headers:{Range:"bytes=0-"+(l-1)}})}if(n.status>=300)throw Error("Bad response code: "+n.status);let s=n.headers.get("Content-Length");if(n.status===200&&(!s||+s>i))throw t&&t.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield n.arrayBuffer(),etag:n.headers.get("ETag")||void 0,cacheControl:n.headers.get("Cache-Control")||void 0,expires:n.headers.get("Expires")||void 0}})}};function G(e,i){let r=e.getUint32(i+4,!0),t=e.getUint32(i+0,!0);return r*Math.pow(2,32)+t}function Hi(e,i){let r=new DataView(e),t=r.getUint8(7);if(t>3)throw Error(`Archive is spec version ${t} but this library supports up to spec version 3`);return{specVersion:t,rootDirectoryOffset:G(r,8),rootDirectoryLength:G(r,16),jsonMetadataOffset:G(r,24),jsonMetadataLength:G(r,32),leafDirectoryOffset:G(r,40),leafDirectoryLength:G(r,48),tileDataOffset:G(r,56),tileDataLength:G(r,64),numAddressedTiles:G(r,72),numTileEntries:G(r,80),numTileContents:G(r,88),clustered:r.getUint8(96)===1,internalCompression:r.getUint8(97),tileCompression:r.getUint8(98),tileType:r.getUint8(99),minZoom:r.getUint8(100),maxZoom:r.getUint8(101),minLon:r.getInt32(102,!0)/1e7,minLat:r.getInt32(106,!0)/1e7,maxLon:r.getInt32(110,!0)/1e7,maxLat:r.getInt32(114,!0)/1e7,centerZoom:r.getUint8(118),centerLon:r.getInt32(119,!0)/1e7,centerLat:r.getInt32(123,!0)/1e7,etag:i}}function At(e){let i={buf:new Uint8Array(e),pos:0},r=me(i),t=[],n=0;for(let s=0;s<r;s++){let o=me(i);t.push({tileId:n+o,offset:0,length:0,runLength:1}),n+=o}for(let s=0;s<r;s++)t[s].runLength=me(i);for(let s=0;s<r;s++)t[s].length=me(i);for(let s=0;s<r;s++){let o=me(i);o===0&&s>0?t[s].offset=t[s-1].offset+t[s-1].length:t[s].offset=o-1}return t}function Ki(e){let i=new DataView(e);return i.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):i.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var de=class extends Error{};function Ji(e,i,r,t){return U(this,null,function*(){let n=yield e.getBytes(0,16384);if(new DataView(n.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Ki(n.data)<3)return[yield Vt.getHeader(e)];let o=n.data.slice(0,Ni),a=n.etag;t&&n.etag!=t&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+e.getKey()),a=void 0);let l=Hi(o,a);if(r){let f=n.data.slice(l.rootDirectoryOffset,l.rootDirectoryOffset+l.rootDirectoryLength),u=e.getKey()+"|"+(l.etag||"")+"|"+l.rootDirectoryOffset+"|"+l.rootDirectoryLength,c=At(yield i(f,l.internalCompression));return[l,[u,c.length,c]]}return[l,void 0]})}function Gi(e,i,r,t,n){return U(this,null,function*(){let s=yield e.getBytes(r,t);if(n.etag&&n.etag!==s.etag)throw new de(s.etag);let o=yield i(s.data,n.internalCompression),a=At(o);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var Qi=class{constructor(e=100,i=!0,r=It){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.prefetch=i,this.decompress=r}getHeader(e,i){return U(this,null,function*(){let r=e.getKey();if(this.cache.has(r))return this.cache.get(r).lastUsed=this.counter++,yield this.cache.get(r).data;let t=new Promise((n,s)=>{Ji(e,this.decompress,this.prefetch,i).then(o=>{o[1]&&this.cache.set(o[1][0],{lastUsed:this.counter++,data:Promise.resolve(o[1][2])}),n(o[0]),this.prune()}).catch(o=>{s(o)})});return this.cache.set(r,{lastUsed:this.counter++,data:t}),t})}getDirectory(e,i,r,t){return U(this,null,function*(){let n=e.getKey()+"|"+(t.etag||"")+"|"+i+"|"+r;if(this.cache.has(n))return this.cache.get(n).lastUsed=this.counter++,yield this.cache.get(n).data;let s=new Promise((o,a)=>{Gi(e,this.decompress,i,r,t).then(l=>{o(l),this.prune()}).catch(l=>{a(l)})});return this.cache.set(n,{lastUsed:this.counter++,data:s}),s})}getArrayBuffer(e,i,r,t){return U(this,null,function*(){let n=e.getKey()+"|"+(t.etag||"")+"|"+i+"|"+r;if(this.cache.has(n))return this.cache.get(n).lastUsed=this.counter++,yield this.cache.get(n).data;let s=new Promise((o,a)=>{e.getBytes(i,r).then(l=>{if(t.etag&&t.etag!==l.etag)throw new de(l.etag);o(l.data),this.cache.has(n),this.prune()}).catch(l=>{a(l)})});return this.cache.set(n,{lastUsed:this.counter++,data:s}),s})}prune(){if(this.cache.size>=this.maxCacheEntries){let e=1/0,i;this.cache.forEach((r,t)=>{r.lastUsed<e&&(e=r.lastUsed,i=t)}),i&&this.cache.delete(i)}}invalidate(e,i){return U(this,null,function*(){this.cache.delete(e.getKey()),yield this.getHeader(e,i)})}},er=class{constructor(e,i,r){typeof e=="string"?this.source=new Zi(e):this.source=e,r?this.decompress=r:this.decompress=It,i?this.cache=i:this.cache=new Qi}getHeader(){return U(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,i,r,t){return U(this,null,function*(){let n=$i(e,i,r),s=yield this.cache.getHeader(this.source);if(s.specVersion<3)return Vt.getZxy(s,this.source,this.cache,e,i,r,t);if(e<s.minZoom||e>s.maxZoom)return;let o=s.rootDirectoryOffset,a=s.rootDirectoryLength;for(let l=0;l<=3;l++){let f=yield this.cache.getDirectory(this.source,o,a,s),u=Wi(f,n);if(u)if(u.runLength>0){let c=yield this.source.getBytes(s.tileDataOffset+u.offset,u.length,t);if(s.etag&&s.etag!==c.etag)throw new de(c.etag);return{data:yield this.decompress(c.data,s.tileCompression),cacheControl:c.cacheControl,expires:c.expires}}else o=s.leafDirectoryOffset+u.offset,a=u.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(e,i,r,t){return U(this,null,function*(){try{return yield this.getZxyAttempt(e,i,r,t)}catch(n){if(n instanceof de)return this.cache.invalidate(this.source,n.message),yield this.getZxyAttempt(e,i,r,t);throw n}})}getMetadataAttempt(){return U(this,null,function*(){let e=yield this.cache.getHeader(this.source),i=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength);if(e.etag&&e.etag!==i.etag)throw new de(i.etag);let r=yield this.decompress(i.data,e.internalCompression),t=new TextDecoder("utf-8");return JSON.parse(t.decode(r))})}getMetadata(){return U(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof de)return this.cache.invalidate(this.source,e.message),yield this.getMetadataAttempt();throw e}})}},ce;(function(e){e[e.Point=1]="Point",e[e.Line=2]="Line",e[e.Polygon=3]="Polygon"})(ce||(ce={}));function le(e){return e.x+":"+e.y+":"+e.z}var tr=(e,i,r)=>{e.pos=i;for(var t=e.readVarint()+e.pos,n=1,s=0,o=0,a=0,l=1/0,f=-1/0,u=1/0,c=-1/0,g=[],w=[];e.pos<t;){if(s<=0){var x=e.readVarint();n=x&7,s=x>>3}if(s--,n===1||n===2)o+=e.readSVarint()*r,a+=e.readSVarint()*r,o<l&&(l=o),o>f&&(f=o),a<u&&(u=a),a>c&&(c=a),n===1&&(w.length>0&&g.push(w),w=[]),w.push(new we.default(o,a));else if(n===7)w&&w.push(w[0].clone());else throw new Error("unknown command "+n)}return w&&g.push(w),{geom:g,bbox:{minX:l,minY:u,maxX:f,maxY:c}}};function Rt(e,i){let r=new gi.VectorTile(new vi.default(e)),t=new Map;for(let[n,s]of Object.entries(r.layers)){let o=[],a=s;for(let l=0;l<a.length;l++){let f=tr(a.feature(l)._pbf,a.feature(l)._geometry,i/a.extent),u=0;for(let c of f.geom)u+=c.length;o.push({id:a.feature(l).id,geomType:a.feature(l).type,geom:f.geom,numVertices:u,bbox:f.bbox,props:a.feature(l).properties})}t.set(n,o)}return t}var tt=class{constructor(e,i){typeof e=="string"?this.p=new er(e):this.p=e,this.controllers=[],this.shouldCancelZooms=i}get(e,i){return Z(this,null,function*(){this.shouldCancelZooms&&(this.controllers=this.controllers.filter(s=>s[0]!=e.z?(s[1].abort(),!1):!0));let r=new AbortController;this.controllers.push([e.z,r]);let t=r.signal,n=yield this.p.getZxy(e.z,e.x,e.y,t);return n?Rt(n.data,i):new Map})}},ir=class{constructor(e,i){this.url=e,this.controllers=[],this.shouldCancelZooms=i}get(e,i){return Z(this,null,function*(){this.shouldCancelZooms&&(this.controllers=this.controllers.filter(s=>s[0]!=e.z?(s[1].abort(),!1):!0));let r=this.url.replace("{z}",e.z.toString()).replace("{x}",e.x.toString()).replace("{y}",e.y.toString()),t=new AbortController;this.controllers.push([e.z,t]);let n=t.signal;return new Promise((s,o)=>{fetch(r,{signal:n}).then(a=>a.arrayBuffer()).then(a=>{let l=Rt(a,i);s(l)}).catch(a=>{o(a)})})})}},Ve=6378137,it=85.0511287798,ze=Ve*Math.PI,rr=e=>{let i=Math.PI/180,r=Math.max(Math.min(it,e[0]),-it),t=Math.sin(r*i);return new we.default(Ve*e[1]*i,Ve*Math.log((1+t)/(1-t))/2)};function rt(e){return e*e}function Le(e,i){return rt(e.x-i.x)+rt(e.y-i.y)}function nr(e,i,r){var t=Le(i,r);if(t===0)return Le(e,i);var n=((e.x-i.x)*(r.x-i.x)+(e.y-i.y)*(r.y-i.y))/t;return n=Math.max(0,Math.min(1,n)),Le(e,new we.default(i.x+n*(r.x-i.x),i.y+n*(r.y-i.y)))}function nt(e,i){for(var r=!1,t=0,n=i.length-1;t<i.length;n=t++){var s=i[t].x,o=i[t].y,a=i[n].x,l=i[n].y,f=o>e.y!=l>e.y&&e.x<(a-s)*(e.y-o)/(l-o)+s;f&&(r=!r)}return r}function sr(e){for(var i=0,r=0;r<e.length;r++){let t=(r+1)%e.length;i+=e[r].x*e[t].y,i-=e[t].x*e[r].y}return i<0}function ar(e,i){var r=!1;for(let t of i)if(sr(t))nt(e,t)&&(r=!1);else{if(r)return!0;nt(e,t)&&(r=!0)}return r}function or(e,i){let r=1/0;for(let t of i){let n=Math.sqrt(Le(e,t[0]));n<r&&(r=n)}return r}function lr(e,i){let r=1/0;for(let n of i)for(var t=0;t<n.length-1;t++){let s=Math.sqrt(nr(e,n[t],n[t+1]));s<r&&(r=s)}return r}var hr=class{constructor(e,i){this.source=e,this.cache=new Map,this.inflight=new Map,this.tileSize=i}queryFeatures(e,i,r,t){let n=rr([i,e]);var s=new we.default((n.x+ze)/(ze*2),1-(n.y+ze)/(ze*2));s.x>1&&(s.x=s.x-Math.floor(s.x));let o=s.mult(1<<r),a=Math.floor(o.x),l=Math.floor(o.y),f=le({z:r,x:a,y:l}),u=[],c=this.cache.get(f);if(c){let g=new we.default((o.x-a)*this.tileSize,(o.y-l)*this.tileSize);for(let[w,x]of c.data.entries())for(let _ of x)_.geomType==1?or(g,_.geom)<t&&u.push({feature:_,layerName:w}):_.geomType==2?lr(g,_.geom)<t&&u.push({feature:_,layerName:w}):ar(g,_.geom)&&u.push({feature:_,layerName:w})}return u}get(e){return Z(this,null,function*(){let i=le(e);return new Promise((r,t)=>{let n=this.cache.get(i);if(n)n.used=performance.now(),r(n.data);else{let s=this.inflight.get(i);s?s.push([r,t]):(this.inflight.set(i,[]),this.source.get(e,this.tileSize).then(o=>{this.cache.set(i,{used:performance.now(),data:o});let a=this.inflight.get(i);if(a&&a.forEach(l=>l[0](o)),this.inflight.delete(i),r(o),this.cache.size>=64){let l=1/0,f;this.cache.forEach((u,c)=>{u.used<l&&(l=u.used,f=c)}),f&&this.cache.delete(f)}}).catch(o=>{let a=this.inflight.get(i);a&&a.forEach(l=>l[1](o)),this.inflight.delete(i),t(o)}))}})})}},jt=(e,i,r)=>{let t=[];for(let n of e){let s=[];for(let o of n)s.push(o.clone().mult(i).add(r));t.push(s)}return t},ke=(e,i)=>{let r=1<<i;return e<0&&(e=r+e),e>=r&&(e=e%r),e},fr=class{constructor(e,i,r){this.tileCache=e,this.maxDataLevel=i,this.levelDiff=r}dataTilesForBounds(e,i){let r=Math.pow(2,e)/Math.pow(2,Math.ceil(e)),t=[];var n=1,s=this.tileCache.tileSize;if(e<this.levelDiff)n=1/(1<<this.levelDiff-e)*r,t.push({data_tile:{z:0,x:0,y:0},origin:new he.default(0,0),scale:n,dim:s*n});else if(e<=this.levelDiff+this.maxDataLevel){let l=1<<this.levelDiff,f=256*r,u=Math.ceil(e)-this.levelDiff,c=Math.floor(i.minX/l/f),g=Math.floor(i.minY/l/f),w=Math.floor(i.maxX/l/f),x=Math.floor(i.maxY/l/f);for(var o=c;o<=w;o++)for(var a=g;a<=x;a++){let _=new he.default(o*l*f,a*l*f);t.push({data_tile:{z:u,x:ke(o,u),y:ke(a,u)},origin:_,scale:r,dim:s*r})}}else{let l=1<<this.levelDiff;n=(1<<Math.ceil(e)-this.maxDataLevel-this.levelDiff)*r;let f=Math.floor(i.minX/l/256/n),u=Math.floor(i.minY/l/256/n),c=Math.floor(i.maxX/l/256/n),g=Math.floor(i.maxY/l/256/n);for(var o=f;o<=c;o++)for(var a=u;a<=g;a++){let _=new he.default(o*l*256*n,a*l*256*n);t.push({data_tile:{z:this.maxDataLevel,x:ke(o,this.maxDataLevel),y:ke(a,this.maxDataLevel)},origin:_,scale:n,dim:s*n})}}return t}dataTileForDisplayTile(e){var i,r=1,t=this.tileCache.tileSize,n;if(e.z<this.levelDiff)i={z:0,x:0,y:0},r=1/(1<<this.levelDiff-e.z),n=new he.default(0,0),t=t*r;else if(e.z<=this.levelDiff+this.maxDataLevel){let s=1<<this.levelDiff;i={z:e.z-this.levelDiff,x:Math.floor(e.x/s),y:Math.floor(e.y/s)},n=new he.default(i.x*s*256,i.y*s*256)}else{r=1<<e.z-this.maxDataLevel-this.levelDiff;let s=1<<this.levelDiff;i={z:this.maxDataLevel,x:Math.floor(e.x/s/r),y:Math.floor(e.y/s/r)},n=new he.default(i.x*s*r*256,i.y*s*r*256),t=t*r}return{data_tile:i,scale:r,origin:n,dim:t}}getBbox(e,i){return Z(this,null,function*(){let r=this.dataTilesForBounds(e,i);return(yield Promise.all(r.map(n=>this.tileCache.get(n.data_tile)))).map((n,s)=>{let o=r[s];return{data:n,z:e,data_tile:o.data_tile,scale:o.scale,dim:o.dim,origin:o.origin}})})}getDisplayTile(e){return Z(this,null,function*(){let i=this.dataTileForDisplayTile(e);return{data:yield this.tileCache.get(i.data_tile),z:e.z,data_tile:i.data_tile,scale:i.scale,origin:i.origin,dim:i.dim}})}queryFeatures(e,i,r){let t=Math.round(r),n=Math.min(t-this.levelDiff,this.maxDataLevel),s=16/(1<<t-n);return this.tileCache.queryFeatures(e,i,n,s)}},Ot=e=>{let i=t=>{let n=t.levelDiff===void 0?2:t.levelDiff,s=t.maxDataZoom||14,o;typeof t.url=="string"?t.url.endsWith(".pmtiles")?o=new tt(t.url,!0):o=new ir(t.url,!0):o=new tt(t.url,!0);let a=new hr(o,256*1<<n);return new fr(a,s,n)},r=new Map;if(e.sources)for(let t in e.sources)r.set(t,i(e.sources[t]));else r.set("",i(e));return r},ur=N(ne());function Ut(e,i,r,t,n,s,o,a,l){let f=performance.now();e.save(),e.miterLimit=2;for(var u of n){if(u.minzoom&&i<u.minzoom||u.maxzoom&&i>u.maxzoom)continue;let x=r.get(u.dataSource||"");if(x)for(let _ of x){var c=_.data.get(u.dataLayer);if(c===void 0)continue;u.symbolizer.before&&u.symbolizer.before(e,_.z);let M=_.origin,S=_.dim,d=_.scale;if(e.save(),a){e.beginPath();let m=Math.max(M.x-o.x,s.minX-o.x),y=Math.max(M.y-o.y,s.minY-o.y),z=Math.min(M.x-o.x+S,s.maxX-o.x),k=Math.min(M.y-o.y+S,s.maxY-o.y);e.rect(m,y,z-m,k-y),e.clip()}e.translate(M.x-o.x,M.y-o.y);for(var g of c){let m=g.geom,y=g.bbox;y.maxX*d+M.x<s.minX||y.minX*d+M.x>s.maxX||y.minY*d+M.y>s.maxY||y.maxY*d+M.y<s.minY||u.filter&&!u.filter(_.z,g)||(d!=1&&(m=jt(m,d,new ur.default(0,0))),u.symbolizer.draw(e,m,_.z,g))}e.restore()}}if(a&&(e.beginPath(),e.rect(s.minX-o.x,s.minY-o.y,s.maxX-s.minX,s.maxY-s.minY),e.clip()),t){let x=t.searchBbox(s,1/0);for(var w of x)if(e.save(),e.translate(w.anchor.x-o.x,w.anchor.y-o.y),w.draw(e),e.restore(),l){e.lineWidth=.5,e.strokeStyle=l,e.fillStyle=l,e.globalAlpha=1,e.fillRect(w.anchor.x-o.x-2,w.anchor.y-o.y-2,4,4);for(let _ of w.bboxes)e.strokeRect(_.minX-o.x,_.minY-o.y,_.maxX-_.minX,_.maxY-_.minY)}}return e.restore(),performance.now()-f}var dr=N(ne()),cr=N(ci()),pr=(e,i,r)=>{let t=256,n=i/t,s=Math.floor(r.minX/t),o=Math.floor(r.minY/t),a=Math.floor(r.maxX/t),l=Math.floor(r.maxY/t),f=Math.log2(n),u=[];for(let c=s;c<=a;c++){let g=c%(1<<e);for(let w=o;w<=l;w++)u.push({display:le({z:e,x:g,y:w}),key:le({z:e-f,x:Math.floor(g/n),y:Math.floor(w/n)})})}return u},mr=class{constructor(e,i){this.tree=new cr.default,this.current=new Map,this.dim=e,this.maxLabeledTiles=i}hasPrefix(e){for(let i of this.current.keys())if(i.startsWith(e))return!0;return!1}has(e){return this.current.has(e)}size(){return this.current.size}keys(){return this.current.keys()}searchBbox(e,i){let r=new Set;for(let t of this.tree.search(e))t.indexed_label.order<=i&&r.add(t.indexed_label);return r}searchLabel(e,i){let r=new Set;for(let t of e.bboxes)for(let n of this.tree.search(t))n.indexed_label.order<=i&&r.add(n.indexed_label);return r}bboxCollides(e,i){for(let r of this.tree.search(e))if(r.indexed_label.order<=i)return!0;return!1}labelCollides(e,i){for(let r of e.bboxes)for(let t of this.tree.search(r))if(t.indexed_label.order<=i)return!0;return!1}deduplicationCollides(e){if(!e.deduplicationKey||!e.deduplicationDistance)return!1;let i=e.deduplicationDistance,r={minX:e.anchor.x-i,minY:e.anchor.y-i,maxX:e.anchor.x+i,maxY:e.anchor.y+i};for(let t of this.tree.search(r))if(t.indexed_label.deduplicationKey===e.deduplicationKey&&t.indexed_label.anchor.dist(e.anchor)<i)return!0;return!1}makeEntry(e){this.current.get(e)&&console.log("consistency error 1");let i=new Set;this.current.set(e,i)}insert(e,i,r){let t={anchor:e.anchor,bboxes:e.bboxes,draw:e.draw,order:i,tileKey:r,deduplicationKey:e.deduplicationKey,deduplicationDistance:e.deduplicationDistance},n=this.current.get(r);if(!n){let u=new Set;this.current.set(r,u),n=u}n.add(t);var s=!1,o=!1;for(let u of e.bboxes){var a=u;a.indexed_label=t,this.tree.insert(a),u.minX<0&&(s=!0),u.maxX>this.dim&&(o=!0)}if(s||o){var l=s?this.dim:-this.dim,f=[];for(let g of e.bboxes)f.push({minX:g.minX+l,minY:g.minY,maxX:g.maxX+l,maxY:g.maxY});let u={anchor:new dr.default(e.anchor.x+l,e.anchor.y),bboxes:f,draw:e.draw,order:i,tileKey:r},c=this.current.get(r);c&&c.add(u);for(let g of f){var a=g;a.indexed_label=u,this.tree.insert(a)}}}pruneOrNoop(e){let i=e.split(":"),r,t=0,n=0;for(var s of this.current.keys()){let o=s.split(":");if(o[3]===i[3]){n++;let a=Math.sqrt(Math.pow(+o[0]-+i[0],2)+Math.pow(+o[1]-+i[1],2));a>t&&(t=a,r=s)}r&&n>this.maxLabeledTiles&&this.pruneKey(r)}}pruneKey(e){let i=this.current.get(e);if(!i)return;let r=[];for(let t of this.tree.all())i.has(t.indexed_label)&&r.push(t);r.forEach(t=>{this.tree.remove(t)}),this.current.delete(e)}removeLabel(e){let i=[];for(let t of this.tree.all())e==t.indexed_label&&i.push(t);i.forEach(t=>{this.tree.remove(t)});let r=this.current.get(e.tileKey);r&&r.delete(e)}},qt=class{constructor(e,i,r,t,n){this.index=new mr(256*1<<e,t),this.z=e,this.scratch=i,this.labelRules=r,this.callback=n}layout(e){let i=performance.now(),r=new Set;for(let[o,a]of e)for(let l of a){let f=le(l.data_tile)+":"+o;this.index.has(f)||(this.index.makeEntry(f),r.add(f))}let t=new Set;for(let[o,a]of this.labelRules.entries()){if(a.visible==!1||a.minzoom&&this.z<a.minzoom||a.maxzoom&&this.z>a.maxzoom)continue;let l=a.dataSource||"",f=e.get(l);if(f)for(let u of f){let c=le(u.data_tile)+":"+l;if(!r.has(c))continue;let g=u.data.get(a.dataLayer);if(g===void 0)continue;let w=g;a.sort&&w.sort((_,M)=>a.sort?a.sort(_.props,M.props):0);let x={index:this.index,zoom:this.z,scratch:this.scratch,order:o,overzoom:this.z-u.data_tile.z};for(let _ of w){if(a.filter&&!a.filter(this.z,_))continue;let M=jt(_.geom,u.scale,u.origin),S=a.symbolizer.place(x,M,_);if(S)for(let d of S){var n=!1;if(!(d.deduplicationKey&&this.index.deduplicationCollides(d))){if(this.index.labelCollides(d,1/0)){if(!this.index.labelCollides(d,o)){let m=this.index.searchLabel(d,1/0);for(let y of m){this.index.removeLabel(y);for(let z of y.bboxes)this.findInvalidatedTiles(t,u.dim,z,c)}this.index.insert(d,o,c),n=!0}}else this.index.insert(d,o,c),n=!0;if(n)for(let m of d.bboxes)(m.maxX>u.origin.x+u.dim||m.minX<u.origin.x||m.minY<u.origin.y||m.maxY>u.origin.y+u.dim)&&this.findInvalidatedTiles(t,u.dim,m,c)}}}}}for(var s of r)this.index.pruneOrNoop(s);return t.size>0&&this.callback&&this.callback(t),performance.now()-i}findInvalidatedTiles(e,i,r,t){let n=pr(this.z,i,r);for(let s of n)s.key!=t&&this.index.hasPrefix(s.key)&&e.add(s.display)}add(e){var i=!0;for(let[r,t]of e)for(let n of t)this.index.has(le(n.data_tile)+":"+r)||(i=!1);return i?0:this.layout(e)}},st=class{constructor(e,i,r,t){this.labelers=new Map,this.scratch=e,this.labelRules=i,this.maxLabeledTiles=r,this.callback=t}add(e,i){var r=this.labelers.get(e);return r||(r=new qt(e,this.scratch,this.labelRules,this.maxLabeledTiles,this.callback),this.labelers.set(e,r)),r.add(i)}getIndex(e){let i=this.labelers.get(e);if(i)return i.index}},Ie={earth:"#FFFBF6",glacier:"#ffffff",residential:"#F4F4F8",hospital:"#FFF6F6",cemetery:"#EFF2EE",school:"#F7F6FF",industrial:"#FFF9EF",wood:"#F4F9EF",grass:"#EBF9E3",park:"#E5F9D5",water:"#B7DFF2",sand:"#ebebeb",buildings:"#F2EDE8",highwayCasing:"#FFC3C3",majorRoadCasing:"#FFB9B9",mediumRoadCasing:"#FFCE8E",minorRoadCasing:"#cccccc",highway:"#FFCEBB",majorRoad:"#FFE4B3",mediumRoad:"#FFF2C8",minorRoad:"#ffffff",boundaries:"#9e9e9e",mask:"#dddddd",countryLabel:"#aaaaaa",cityLabel:"#6C6C6C",stateLabel:"#999999",neighbourhoodLabel:"#888888",landuseLabel:"#898989",waterLabel:"#41ABDC",naturalLabel:"#4B8F14",roadsLabel:"#888888",poisLabel:"#606060"},Ae={earth:"#151515",glacier:"#1c1c1c",residential:"#252B2F",hospital:"#3E2C2C",cemetery:"#36483D",school:"#2C3440",industrial:"#33312C",wood:"#3A3E38",grass:"#4E604D",park:"#2C4034",water:"#4D5B73",sand:"#777777",buildings:"#464545",highwayCasing:"#000000",majorRoadCasing:"#1C1B1B",mediumRoadCasing:"#3E3E3E",minorRoadCasing:"#000000",highway:"#5B5B5B",majorRoad:"#595959",mediumRoad:"#4F4F4F",minorRoad:"#393939",boundaries:"#666666",mask:"#dddddd",countryLabel:"#ffffff",cityLabel:"#FFFFFF",stateLabel:"#ffffff",neighbourhoodLabel:"#FDFDFD",landuseLabel:"#DDDDDD",waterLabel:"#707E95",naturalLabel:"#4c4c4c",roadsLabel:"#C4C4C4",poisLabel:"#959393"};function ve(e,i,r){return Math.min(Math.max(e,r),i)}var ye=class extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}};function yr(e){if(typeof e!="string")throw new ye(e);if(e.trim().toLowerCase()==="transparent")return[0,0,0,0];let i=e.trim();i=br.test(e)?function(o){let a=o.toLowerCase().trim(),l=gr[function(f){let u=5381,c=f.length;for(;c;)u=33*u^f.charCodeAt(--c);return(u>>>0)%2341}(a)];if(!l)throw new ye(o);return`#${l}`}(e):e;let r=vr.exec(i);if(r){let o=Array.from(r).slice(1);return[...o.slice(0,3).map(a=>parseInt(xe(a,2),16)),parseInt(xe(o[3]||"f",2),16)/255]}let t=wr.exec(i);if(t){let o=Array.from(t).slice(1);return[...o.slice(0,3).map(a=>parseInt(a,16)),parseInt(o[3]||"ff",16)/255]}let n=xr.exec(i);if(n){let o=Array.from(n).slice(1);return[...o.slice(0,3).map(a=>parseInt(a,10)),parseFloat(o[3]||"1")]}let s=_r.exec(i);if(s){let[o,a,l,f]=Array.from(s).slice(1).map(parseFloat);if(ve(0,100,a)!==a)throw new ye(e);if(ve(0,100,l)!==l)throw new ye(e);return[...zr(o,a,l),f||1]}throw new ye(e)}var at=e=>parseInt(e.replace(/_/g,""),36),gr="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((e,i)=>{let r=at(i.substring(0,3)),t=at(i.substring(3)).toString(16),n="";for(let s=0;s<6-t.length;s++)n+="0";return e[r]=`${n}${t}`,e},{}),xe=(e,i)=>Array.from(Array(i)).map(()=>e).join(""),vr=new RegExp(`^#${xe("([a-f0-9])",3)}([a-f0-9])?$`,"i"),wr=new RegExp(`^#${xe("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),xr=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${xe(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),_r=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,br=/^[a-z]+$/i,ot=e=>Math.round(255*e),zr=(e,i,r)=>{let t=r/100;if(i===0)return[t,t,t].map(ot);let n=(e%360+360)%360/60,s=(1-Math.abs(2*t-1))*(i/100),o=s*(1-Math.abs(n%2-1)),a=0,l=0,f=0;n>=0&&n<1?(a=s,l=o):n>=1&&n<2?(a=o,l=s):n>=2&&n<3?(l=s,f=o):n>=3&&n<4?(l=o,f=s):n>=4&&n<5?(a=o,f=s):n>=5&&n<6&&(a=s,f=o);let u=t-s/2;return[a+u,l+u,f+u].map(ot)};function lt(e){let[i,r,t,n]=yr(e).map((f,u)=>u===3?f:f/255),s=Math.max(i,r,t),o=Math.min(i,r,t),a=(s+o)/2;if(s===o)return[0,0,a,n];let l=s-o;return[60*(i===s?(r-t)/l+(r<t?6:0):r===s?(t-i)/l+2:(i-r)/l+4),a>.5?l/(2-s-o):l/(s+o),a,n]}function kr(e,i,r,t){return`hsla(${(e%360).toFixed()}, ${ve(0,100,100*i).toFixed()}%, ${ve(0,100,100*r).toFixed()}%, ${parseFloat(ve(0,1,t).toFixed(3))})`}var K=N(ne()),Mr=N(pi()),Fr=N(yi()),q=class{constructor(e,i){this.str=e??i,this.per_feature=typeof this.str=="function"&&this.str.length==2}get(e,i){return typeof this.str=="function"?this.str(e,i):this.str}},R=class{constructor(e,i=1){this.value=e??i,this.per_feature=typeof this.value=="function"&&this.value.length==2}get(e,i){return typeof this.value=="function"?this.value(e,i):this.value}},qe=class{constructor(e){var i;this.label_props=(i=e?.label_props)!=null?i:["name"],this.textTransform=e?.textTransform}get(e,i){let r,t;typeof this.label_props=="function"?t=this.label_props(e,i):t=this.label_props;for(let s of t)if(i.props.hasOwnProperty(s)&&typeof i.props[s]=="string"){r=i.props[s];break}let n;return typeof this.textTransform=="function"?n=this.textTransform(e,i):n=this.textTransform,r&&n==="uppercase"?r=r.toUpperCase():r&&n==="lowercase"?r=r.toLowerCase():r&&n==="capitalize"&&(r=r.toLowerCase().split(" ").map(a=>a[0].toUpperCase()+a.slice(1)).join(" ")),r}},$e=class{constructor(e){var i,r;e?.font?this.font=e.font:(this.family=(i=e?.fontFamily)!=null?i:"sans-serif",this.size=(r=e?.fontSize)!=null?r:12,this.weight=e?.fontWeight,this.style=e?.fontStyle)}get(e,i){if(this.font)return typeof this.font=="function"?this.font(e,i):this.font;var r="";this.style&&(typeof this.style=="function"?r=this.style(e,i)+" ":r=this.style+" ");var t="";this.weight&&(typeof this.weight=="function"?t=this.weight(e,i)+" ":t=this.weight+" ");var n;typeof this.size=="function"?n=this.size(e,i):n=this.size;var s;return typeof this.family=="function"?s=this.family(e,i):s=this.family,`${r}${t}${n}px ${s}`}},Lr=class{constructor(e,i=[]){this.value=e??i,this.per_feature=typeof this.value=="function"&&this.value.length==2}get(e,i){return typeof this.value=="function"?this.value(e,i):this.value}},ht=N(ne()),Sr=(e,i,r)=>{var t=[],n,s,o,a=0,l=0,f=0,u=0,c=0,g=0,w=0,x=0,_=0,M=0,S=0,d=0;if(e.length<2)return[];if(e.length===2)return f=Math.sqrt(Math.pow(e[1].x-e[0].x,2)+Math.pow(e[1].y-e[0].y,2)),[{length:f,beginIndex:0,beginDistance:0,endIndex:2,endDistance:f}];for(u=Math.sqrt(Math.pow(e[1].x-e[0].x,2)+Math.pow(e[1].y-e[0].y,2)),a=1,l=e.length-1;a<l;a++)n=e[a-1],s=e[a],o=e[a+1],g=s.x-n.x,w=s.y-n.y,x=o.x-s.x,_=o.y-s.y,c=Math.sqrt(x*x+_*_),f+=u,M=Math.acos((g*x+w*_)/(u*c)),(M>i||f-d>r)&&(t.push({length:f-d,beginDistance:d,beginIndex:S,endIndex:a+1,endDistance:f}),S=a,d=f),u=c;return a-S>0&&t.push({length:f-d+c,beginIndex:S,beginDistance:d,endIndex:a+1,endDistance:f+c}),t};function Dr(e,i,r,t){let n,s,o=0,a=[];var l=-1/0;for(let u of e){let c=Sr(u,Math.PI/45,i);for(let g of c)if(g.length>=i+t){let w=new ht.default(u[g.beginIndex].x,u[g.beginIndex].y),x=u[g.endIndex-1],_=new ht.default((x.x-w.x)/g.length,(x.y-w.y)/g.length);for(var f=t;f<g.length-i;f+=r)a.push({start:w.add(_.mult(f)),end:w.add(_.mult(f+i))})}}return a}function Cr(e,i,r,t){let n=i.x-e.x,s=i.y-e.y,o=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2)),a=[];for(var l=0;l<r+t;l+=2*t){let f=l*1/o;a.push({x:e.x+f*n,y:e.y+f*s})}return a}function $t(e,i){if(e.length<=i)return[e];let r=i-1,t=e.lastIndexOf(" ",r),n=e.indexOf(" ",r);if(t==-1&&n==-1)return[e];let s,o;return n==-1||t>=0&&r-t<n-r?(s=e.substring(0,t),o=e.substring(t+1,e.length)):(s=e.substring(0,n),o=e.substring(n+1,e.length)),[s,...$t(o,i)]}var Tr="\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DB5\u4E00-\u9FEA\uF900-\uFA6D\uFA70-\uFAD9\u2000",qr=new RegExp("^["+Tr+"]+$"),Nt=5400,ft;(function(e){e[e.Left=1]="Left",e[e.Center=2]="Center",e[e.Right=3]="Right"})(ft||(ft={}));var ut;(function(e){e[e.N=1]="N",e[e.NE=2]="NE",e[e.E=3]="E",e[e.SE=4]="SE",e[e.S=5]="S",e[e.SW=6]="SW",e[e.W=7]="W",e[e.NW=8]="NW"})(ut||(ut={}));var $r=(e,i,r)=>{let t=document.createElement("canvas"),n=t.getContext("2d");return t.width=e,t.height=i,n!==null&&r(t,n),t},j=class{constructor(e){var i;this.pattern=e.pattern,this.fill=new q(e.fill,"black"),this.opacity=new R(e.opacity,1),this.stroke=new q(e.stroke,"black"),this.width=new R(e.width,0),this.per_feature=(i=this.fill.per_feature||this.opacity.per_feature||this.stroke.per_feature||this.width.per_feature||e.per_feature)!=null?i:!1,this.do_stroke=!1}before(e,i){if(!this.per_feature){e.globalAlpha=this.opacity.get(i),e.fillStyle=this.fill.get(i),e.strokeStyle=this.stroke.get(i);let r=this.width.get(i);r>0&&(this.do_stroke=!0),e.lineWidth=r}if(this.pattern){let r=e.createPattern(this.pattern,"repeat");r&&(e.fillStyle=r)}}draw(e,i,r,t){var n=!1;if(this.per_feature){e.globalAlpha=this.opacity.get(r,t),e.fillStyle=this.fill.get(r,t);var s=this.width.get(r,t);s&&(n=!0,e.strokeStyle=this.stroke.get(r,t),e.lineWidth=s)}let o=()=>{e.fill(),(n||this.do_stroke)&&e.stroke()};var a=0;e.beginPath();for(var l of i){a+l.length>Nt&&(o(),a=0,e.beginPath());for(var f=0;f<l.length;f++){let u=l[f];f==0?e.moveTo(u.x,u.y):e.lineTo(u.x,u.y)}a+=l.length}a>0&&o()}};function Nr(e,i){return r=>{let t=r-e;return t>=0&&t<i.length?i[t]:0}}function Wt(e,i){let r=0;for(;i[r+1][0]<e;)r++;return r}function Zt(e,i,r){return e*(r-i)+i}function Ht(e,i,r,t){let n=t[i+1][0]-t[i][0],s=e-t[i][0];return n===0?0:r===1?s/n:(Math.pow(r,s)-1)/(Math.pow(r,n)-1)}function Q(e,i){return r=>{if(i.length<1)return 0;if(r<=i[0][0])return i[0][1];if(r>=i[i.length-1][0])return i[i.length-1][1];let t=Wt(r,i),n=Ht(r,t,e,i);return Zt(n,i[t][1],i[t+1][1])}}function Wr(e,i){return r=>{if(i.length<1)return 0;let t=e;for(let n=0;n<i.length;n++)r>=i[n][0]&&(t=i[n][1]);return t}}function Zr(e){return Q(1,e)}function Hr(e,i,r,t,n){return s=>{if(n.length<1)return 0;let o=new Mr.default(e,i,r,t),a=Wt(s,n),l=o.solve(Ht(s,a,1,n));return Zt(l,n[a][1],n[a+1][1])}}var W=class{constructor(e){var i;this.color=new q(e.color,"black"),this.width=new R(e.width),this.opacity=new R(e.opacity),this.dash=e.dash?new Lr(e.dash):null,this.dashColor=new q(e.dashColor,"black"),this.dashWidth=new R(e.dashWidth,1),this.lineCap=new q(e.lineCap,"butt"),this.lineJoin=new q(e.lineJoin,"miter"),this.skip=!1,this.per_feature=!!((i=this.dash)!=null&&i.per_feature||this.color.per_feature||this.opacity.per_feature||this.width.per_feature||this.lineCap.per_feature||this.lineJoin.per_feature||e.per_feature)}before(e,i){this.per_feature||(e.strokeStyle=this.color.get(i),e.lineWidth=this.width.get(i),e.globalAlpha=this.opacity.get(i),e.lineCap=this.lineCap.get(i),e.lineJoin=this.lineJoin.get(i))}draw(e,i,r,t){if(this.skip)return;let n=()=>{this.per_feature&&(e.globalAlpha=this.opacity.get(r,t),e.lineCap=this.lineCap.get(r,t),e.lineJoin=this.lineJoin.get(r,t)),this.dash?(e.save(),this.per_feature?(e.lineWidth=this.dashWidth.get(r,t),e.strokeStyle=this.dashColor.get(r,t),e.setLineDash(this.dash.get(r,t))):e.setLineDash(this.dash.get(r)),e.stroke(),e.restore()):(e.save(),this.per_feature&&(e.lineWidth=this.width.get(r,t),e.strokeStyle=this.color.get(r,t)),e.stroke(),e.restore())};var s=0;e.beginPath();for(var o of i){s+o.length>Nt&&(n(),s=0,e.beginPath());for(var a=0;a<o.length;a++){let l=o[a];a==0?e.moveTo(l.x,l.y):e.lineTo(l.x,l.y)}s+=o.length}s>0&&n()}},Kr=class{constructor(e){this.name=e.name,this.sheet=e.sheet,this.dpr=window.devicePixelRatio}place(e,i,r){let t=i[0],n=new K.default(i[0][0].x,i[0][0].y),s=this.sheet.get(this.name),o=s.w/this.dpr,a=s.h/this.dpr,l={minX:n.x-o/2,minY:n.y-a/2,maxX:n.x+o/2,maxY:n.y+a/2};return[{anchor:n,bboxes:[l],draw:u=>{u.globalAlpha=1,u.drawImage(this.sheet.canvas,s.x,s.y,s.w,s.h,-s.w/2/this.dpr,-s.h/2/this.dpr,s.w/2,s.h/2)}}]}},Ce=class{constructor(e){this.radius=new R(e.radius,3),this.fill=new q(e.fill,"black"),this.stroke=new q(e.stroke,"white"),this.width=new R(e.width,0),this.opacity=new R(e.opacity)}draw(e,i,r,t){e.globalAlpha=this.opacity.get(r,t);let n=this.radius.get(r,t),s=this.width.get(r,t);s>0&&(e.strokeStyle=this.stroke.get(r,t),e.lineWidth=s,e.beginPath(),e.arc(i[0][0].x,i[0][0].y,n+s/2,0,2*Math.PI),e.stroke()),e.fillStyle=this.fill.get(r,t),e.beginPath(),e.arc(i[0][0].x,i[0][0].y,n,0,2*Math.PI),e.fill()}place(e,i,r){let t=i[0],n=new K.default(i[0][0].x,i[0][0].y),s=this.radius.get(e.zoom,r),o={minX:n.x-s,minY:n.y-s,maxX:n.x+s,maxY:n.y+s};return[{anchor:n,bboxes:[o],draw:l=>{this.draw(l,[[new K.default(0,0)]],e.zoom,r)}}]}},Br=class{constructor(e){this.font=new $e(e),this.text=new qe(e),this.fill=new q(e.fill,"black"),this.background=new q(e.background,"white"),this.padding=new R(e.padding,0)}place(e,i,r){let t=this.text.get(e.zoom,r);if(!t)return;let n=this.font.get(e.zoom,r);e.scratch.font=n;let s=e.scratch.measureText(t),o=s.width,a=s.actualBoundingBoxAscent,l=s.actualBoundingBoxDescent,f=i[0],u=new K.default(i[0][0].x,i[0][0].y),c=this.padding.get(e.zoom,r),g={minX:u.x-o/2-c,minY:u.y-a-c,maxX:u.x+o/2+c,maxY:u.y+l+c};return[{anchor:u,bboxes:[g],draw:x=>{x.globalAlpha=1,x.fillStyle=this.background.get(e.zoom,r),x.fillRect(-o/2-c,-a-c,o+2*c,a+l+2*c),x.fillStyle=this.fill.get(e.zoom,r),x.font=n,x.fillText(t,-o/2,0)}}]}},dt=class{constructor(e){this.list=e}place(e,i,r){var t=this.list[0].place(e,i,r);if(!t)return;var n=t[0];let s=n.anchor,o=n.bboxes[0],a=o.maxY-o.minY,l=[{draw:n.draw,translate:{x:0,y:0}}],f=[[new K.default(i[0][0].x,i[0][0].y+a)]];for(let c=1;c<this.list.length;c++)t=this.list[c].place(e,f,r),t&&(n=t[0],o=Kt(o,n.bboxes[0]),l.push({draw:n.draw,translate:{x:0,y:a}}));return[{anchor:s,bboxes:[o],draw:c=>{for(let g of l)c.save(),c.translate(g.translate.x,g.translate.y),g.draw(c),c.restore()}}]}},Kt=(e,i)=>({minX:Math.min(e.minX,i.minX),minY:Math.min(e.minY,i.minY),maxX:Math.max(e.maxX,i.maxX),maxY:Math.max(e.maxY,i.maxY)}),ct=class{constructor(e){this.list=e}place(e,i,r){let t=this.list[0];if(!t)return;var n=t.place(e,i,r);if(!n)return;var s=n[0];let o=s.anchor,a=s.bboxes[0],l=[s.draw];for(let u=1;u<this.list.length;u++){if(n=this.list[u].place(e,i,r),!n)return;s=n[0],a=Kt(a,s.bboxes[0]),l.push(s.draw)}return[{anchor:o,bboxes:[a],draw:u=>{l.forEach(c=>c(u))}}]}},Yr=class{constructor(e){this.symbolizer=e}place(e,i,r){let t=i[0][0],n=this.symbolizer.place(e,[[new K.default(0,0)]],r);if(!n||n.length==0)return;let s=n[0],o=s.bboxes[0],a=o.maxX-o.minX,l=o.maxY-o.minY,f={minX:t.x-a/2,maxX:t.x+a/2,minY:t.y-l/2,maxY:t.y+l/2};return[{anchor:t,bboxes:[f],draw:c=>{c.translate(-a/2,l/2-o.maxY),s.draw(c,{justify:2})}}]}},Jr=class{constructor(e,i){this.padding=new R(e,0),this.symbolizer=i}place(e,i,r){let t=this.symbolizer.place(e,i,r);if(!t||t.length==0)return;let n=this.padding.get(e.zoom,r);for(var s of t)for(var o of s.bboxes)o.minX-=n,o.minY-=n,o.maxX+=n,o.maxY+=n;return t}},Ne=class{constructor(e){this.font=new $e(e),this.text=new qe(e),this.fill=new q(e.fill,"black"),this.stroke=new q(e.stroke,"black"),this.width=new R(e.width,0),this.lineHeight=new R(e.lineHeight,1),this.letterSpacing=new R(e.letterSpacing,0),this.maxLineCodeUnits=new R(e.maxLineChars,15),this.justify=e.justify}place(e,i,r){let t=this.text.get(e.zoom,r);if(!t)return;let n=this.font.get(e.zoom,r);e.scratch.font=n;let s=this.letterSpacing.get(e.zoom,r),o=$t(t,this.maxLineCodeUnits.get(e.zoom,r));var a="",l=0;for(let S of o)S.length>l&&(l=S.length,a=S);let f=e.scratch.measureText(a),u=f.width+s*(l-1),c=f.actualBoundingBoxAscent,g=f.actualBoundingBoxDescent,w=(c+g)*this.lineHeight.get(e.zoom,r),x=new K.default(i[0][0].x,i[0][0].y),_={minX:x.x,minY:x.y-c,maxX:x.x+u,maxY:x.y+g+(o.length-1)*w};return[{anchor:x,bboxes:[_],draw:(S,d)=>{S.globalAlpha=1,S.font=n,S.fillStyle=this.fill.get(e.zoom,r);let m=this.width.get(e.zoom,r);var y=0;for(let F of o){var z=0;if(this.justify==2||d&&d.justify==2?z=(u-S.measureText(F).width)/2:(this.justify==3||d&&d.justify==3)&&(z=u-S.measureText(F).width),m)if(S.lineWidth=m*2,S.strokeStyle=this.stroke.get(e.zoom,r),s>0){var k=z;for(var b of F)S.strokeText(b,k,y),k+=S.measureText(b).width+s}else S.strokeText(F,z,y);if(s>0){var k=z;for(var b of F)S.fillText(b,k,y),k+=S.measureText(b).width+s}else S.fillText(F,z,y);y+=w}}}]}},ue=class{constructor(e){this.centered=new Yr(new Ne(e))}place(e,i,r){return this.centered.place(e,i,r)}},Er=class{constructor(e,i){var r,t,n;this.symbolizer=e,this.offsetX=new R(i.offsetX,0),this.offsetY=new R(i.offsetY,0),this.justify=(r=i.justify)!=null?r:void 0,this.placements=(t=i.placements)!=null?t:[2,6,8,4,1,3,5,7],this.ddValues=(n=i.ddValues)!=null?n:()=>({})}place(e,i,r){if(r.geomType!==ce.Point)return;let t=i[0][0],n=this.symbolizer.place(e,[[new K.default(0,0)]],r);if(!n||n.length==0)return;let s=n[0],o=s.bboxes[0],a=this.offsetX,l=this.offsetY,f=this.justify,u=this.placements,{offsetX:c,offsetY:g,justify:w,placements:x}=this.ddValues(e.zoom,r)||{};c&&(a=new R(c,0)),g&&(l=new R(g,0)),w&&(f=w),x&&(u=x);let _=a.get(e.zoom,r),M=l.get(e.zoom,r),S=(k,b)=>({minX:k.x+b.x+o.minX,minY:k.y+b.y+o.minY,maxX:k.x+b.x+o.maxX,maxY:k.y+b.y+o.maxY});var d=new K.default(_,M),m;let y=k=>{k.translate(d.x,d.y),s.draw(k,{justify:m})},z=(k,b)=>{let F=S(k,b);if(!e.index.bboxCollides(F,e.order))return[{anchor:t,bboxes:[F],draw:y}]};for(let k of u){let b=this.computeXAxisOffset(_,o,k),F=this.computeYAxisOffset(M,o,k);return m=this.computeJustify(f,k),d=new K.default(b,F),z(t,d)}}computeXAxisOffset(e,i,r){let t=i.maxX,n=t/2;return[1,5].includes(r)?e-n:[8,7,6].includes(r)?e-t:e}computeYAxisOffset(e,i,r){let t=Math.abs(i.minY),n=i.maxY,s=(i.minY+i.maxY)/2;return[3,7].includes(r)?e-s:[8,2,1].includes(r)?e-n:[6,4,5].includes(r)?e+t:e}computeJustify(e,i){return e||([1,5].includes(i)?2:[2,3,4].includes(i)?1:3)}},Me=class{constructor(e){this.symbolizer=new Er(new Ne(e),e)}place(e,i,r){return this.symbolizer.place(e,i,r)}},pt;(function(e){e[e.Above=1]="Above",e[e.Center=2]="Center",e[e.Below=3]="Below"})(pt||(pt={}));var Jt=class{constructor(e){var i;this.font=new $e(e),this.text=new qe(e),this.fill=new q(e.fill,"black"),this.stroke=new q(e.stroke,"black"),this.width=new R(e.width,0),this.offset=new R(e.offset,0),this.position=(i=e.position)!=null?i:1,this.maxLabelCodeUnits=new R(e.maxLabelChars,40),this.repeatDistance=new R(e.repeatDistance,250)}place(e,i,r){let t=this.text.get(e.zoom,r);if(!t||t.length>this.maxLabelCodeUnits.get(e.zoom,r))return;let n=20,s=r.bbox;if(s.maxY-s.minY<n&&s.maxX-s.minX<n)return;let o=this.font.get(e.zoom,r);e.scratch.font=o;let a=e.scratch.measureText(t),l=a.width,f=a.actualBoundingBoxAscent+a.actualBoundingBoxDescent;var u=this.repeatDistance.get(e.zoom,r);e.overzoom>4&&(u*=1<<e.overzoom-4);let c=f*2,g=Dr(i,l,u,c);if(g.length==0)return;let w=[];for(let x of g){let _=x.end.x-x.start.x,M=x.end.y-x.start.y,d=Cr(x.start,x.end,l,c/2).map(y=>({minX:y.x-c/2,minY:y.y-c/2,maxX:y.x+c/2,maxY:y.y+c/2})),m=y=>{y.globalAlpha=1,y.rotate(Math.atan2(M,_)),_<0&&(y.scale(-1,-1),y.translate(-l,0));let z=0;this.position===3?z+=f:this.position===2&&(z+=f/2),y.translate(0,z-this.offset.get(e.zoom,r)),y.font=o;let k=this.width.get(e.zoom,r);k&&(y.lineWidth=k,y.strokeStyle=this.stroke.get(e.zoom,r),y.strokeText(t,0,0)),y.fillStyle=this.fill.get(e.zoom,r),y.fillText(t,0,0)};w.push({anchor:x.start,bboxes:d,draw:m,deduplicationKey:t,deduplicationDistance:u})}return w}},Ee=class{constructor(e){this.symbolizer=new Ne(e)}place(e,i,r){let t=r.bbox;if((t.maxY-t.minY)*(t.maxX-t.minX)<2e4)return;let s=this.symbolizer.place(e,[[new K.default(0,0)]],r);if(!s||s.length==0)return;let o=s[0],a=o.bboxes[0],l=i[0],f=(0,Fr.default)([l.map(w=>[w.x,w.y])]),u=new K.default(f[0],f[1]),c={minX:u.x-(a.maxX-a.minX)/2,minY:u.y-(a.maxY-a.minY)/2,maxX:u.x+(a.maxX-a.minX)/2,maxY:u.y+(a.maxY-a.minY)/2};return[{anchor:u,bboxes:[c],draw:w=>{w.translate(o.anchor.x-(a.maxX-a.minX)/2,o.anchor.y),o.draw(w)}}]}},Gt=(e,i)=>{let r=lt(i),t=ai({},e);for(let[n,s]of Object.entries(e)){let o=lt(s);t[n]=kr(r[0],r[1],o[2],o[3])}return t},Re=(e,i)=>(i&&(e=Gt(e,i)),[{dataLayer:"earth",symbolizer:new j({fill:e.earth})},{dataLayer:"natural",symbolizer:new j({fill:e.glacier}),filter:(r,t)=>t.props.natural=="glacier"},{dataLayer:"landuse",symbolizer:new j({fill:e.residential}),filter:(r,t)=>t.props.landuse=="residential"||t.props.place=="neighbourhood"},{dataLayer:"landuse",symbolizer:new j({fill:e.hospital}),filter:(r,t)=>t.props.amenity=="hospital"},{dataLayer:"landuse",symbolizer:new j({fill:e.cemetery}),filter:(r,t)=>t.props.landuse=="cemetery"},{dataLayer:"landuse",symbolizer:new j({fill:e.school}),filter:(r,t)=>t.props.amenity=="school"||t.props.amenity=="kindergarten"||t.props.amenity=="university"||t.props.amenity=="college"},{dataLayer:"landuse",symbolizer:new j({fill:e.industrial}),filter:(r,t)=>t.props.landuse=="industrial"},{dataLayer:"natural",symbolizer:new j({fill:e.wood}),filter:(r,t)=>t.props.natural=="wood"},{dataLayer:"landuse",symbolizer:new j({fill:e.grass}),filter:(r,t)=>t.props.landuse=="grass"},{dataLayer:"landuse",symbolizer:new j({fill:e.park}),filter:(r,t)=>t.props.leisure=="park"},{dataLayer:"water",symbolizer:new j({fill:e.water})},{dataLayer:"natural",symbolizer:new j({fill:e.sand}),filter:(r,t)=>t.props.natural=="sand"},{dataLayer:"buildings",symbolizer:new j({fill:e.buildings})},{dataLayer:"roads",symbolizer:new W({color:e.highwayCasing,width:Q(1.4,[[5,1.5],[11,4],[16,9],[20,40]])}),filter:(r,t)=>t.props["pmap:kind"]=="highway"},{dataLayer:"roads",symbolizer:new W({color:e.majorRoadCasing,width:Q(1.4,[[9,3],[12,4],[17,8],[20,22]])}),filter:(r,t)=>t.props["pmap:kind"]=="major_road"},{dataLayer:"roads",symbolizer:new W({color:e.mediumRoadCasing,width:Q(1.4,[[13,3],[17,6],[20,18]])}),filter:(r,t)=>t.props["pmap:kind"]=="medium_road"},{dataLayer:"roads",symbolizer:new W({color:e.minorRoadCasing,width:Q(1.4,[[14,2],[17,5],[20,15]])}),filter:(r,t)=>t.props["pmap:kind"]=="minor_road"},{dataLayer:"roads",symbolizer:new W({color:e.minorRoad,width:Q(1.4,[[14,1],[17,3],[20,13]])}),filter:(r,t)=>t.props["pmap:kind"]=="minor_road"},{dataLayer:"roads",symbolizer:new W({color:e.mediumRoad,width:Q(1.4,[[13,2],[17,4],[20,15]])}),filter:(r,t)=>t.props["pmap:kind"]=="medium_road"},{dataLayer:"roads",symbolizer:new W({color:e.majorRoad,width:Q(1.4,[[9,2],[12,3],[17,6],[20,20]])}),filter:(r,t)=>t.props["pmap:kind"]=="major_road"},{dataLayer:"roads",symbolizer:new W({color:e.highway,width:Q(1.4,[[5,.5],[11,2.5],[16,7],[20,30]])}),filter:(r,t)=>t.props["pmap:kind"]=="highway"},{dataLayer:"boundaries",symbolizer:new W({color:e.boundaries,width:2,opacity:.4})},{dataLayer:"mask",symbolizer:new j({fill:e.mask})}]),je=(e,i,r,t)=>{i&&(e=Gt(e,i));var n=["name"];r&&(n=r);let s=(o,a)=>t?o instanceof Me?new dt([o,new Me({fill:a,label_props:t})]):new dt([o,new ue({fill:a,label_props:t})]):o;return[{dataLayer:"places",symbolizer:s(new ue({label_props:n,fill:e.countryLabel,lineHeight:1.5,font:(o,a)=>o<6?"200 14px sans-serif":"200 20px sans-serif",textTransform:"uppercase"}),e.countryLabel),filter:(o,a)=>a.props["pmap:kind"]=="country"},{dataLayer:"places",symbolizer:s(new ue({label_props:n,fill:e.stateLabel,font:"300 16px sans-serif"}),e.stateLabel),filter:(o,a)=>a.props["pmap:kind"]=="state"},{id:"cities_high",dataLayer:"places",filter:(o,a)=>a.props["pmap:kind"]=="city",minzoom:7,symbolizer:s(new ue({label_props:n,fill:e.cityLabel,font:(o,a)=>a?.props["pmap:rank"]===1?o>8?"600 20px sans-serif":"600 12px sans-serif":o>8?"600 16px sans-serif":"600 10px sans-serif"}),e.cityLabel),sort:(o,a)=>o["pmap:rank"]-a["pmap:rank"]},{id:"cities_low",dataLayer:"places",filter:(o,a)=>a.props["pmap:kind"]=="city",maxzoom:6,symbolizer:new ct([new Ce({radius:2,fill:e.cityLabel}),s(new Me({label_props:n,fill:e.cityLabel,offsetX:2,offsetY:2,font:(o,a)=>a?.props["pmap:rank"]===1?o>8?"600 20px sans-serif":"600 12px sans-serif":o>8?"600 16px sans-serif":"600 10px sans-serif"}),e.cityLabel)]),sort:(o,a)=>o["pmap:rank"]-a["pmap:rank"]},{id:"neighbourhood",dataLayer:"places",symbolizer:s(new ue({label_props:n,fill:e.neighbourhoodLabel,font:"500 10px sans-serif",textTransform:"uppercase"}),e.neighbourhoodLabel),filter:(o,a)=>a.props["pmap:kind"]=="neighbourhood"},{dataLayer:"landuse",symbolizer:s(new Ee({label_props:n,fill:e.landuseLabel,font:"300 12px sans-serif"}),e.landuseLabel)},{dataLayer:"water",symbolizer:s(new Ee({label_props:n,fill:e.waterLabel,font:"italic 600 12px sans-serif"}),e.waterLabel)},{dataLayer:"natural",symbolizer:s(new Ee({label_props:n,fill:e.naturalLabel,font:"italic 300 12px sans-serif"}),e.naturalLabel)},{dataLayer:"roads",symbolizer:s(new Jt({label_props:n,fill:e.roadsLabel,font:"500 12px sans-serif"}),e.roadsLabel),minzoom:12},{dataLayer:"roads",symbolizer:new Br({label_props:["ref"],font:"600 9px sans-serif",background:e.highway,padding:2,fill:e.neighbourhoodLabel}),filter:(o,a)=>a.props["pmap:kind"]=="highway"},{dataLayer:"pois",symbolizer:new ct([new Ce({radius:2,fill:e.poisLabel}),s(new Me({label_props:n,fill:e.poisLabel,offsetX:2,offsetY:2,font:"300 10px sans-serif"}),e.poisLabel)])}]},mt=(e,i,r)=>[{dataSource:e,dataLayer:i,symbolizer:new Ce({opacity:.2,fill:r,radius:4}),filter:(t,n)=>n.geomType==ce.Point},{dataSource:e,dataLayer:i,symbolizer:new W({opacity:.2,color:r,width:2}),filter:(t,n)=>n.geomType==ce.Line},{dataSource:e,dataLayer:i,symbolizer:new j({opacity:.2,fill:r,stroke:r,width:1}),filter:(t,n)=>n.geomType==ce.Polygon}],Qt=(e,i)=>{var r=[];for(var[t,n]of e)for(var s of n)for(var o of s.data.keys())t===i.dataSource&&o===i.dataLayer||(r=r.concat(mt(t,o,"steelblue")));return r=r.concat(mt(i.dataSource||"",i.dataLayer,"red")),r},_e=6378137,yt=85.0511287798,H=_e*Math.PI,ei=e=>{let i=Math.PI/180,r=Math.max(Math.min(yt,e.y),-yt),t=Math.sin(r*i);return new se.default(_e*e.x*i,_e*Math.log((1+t)/(1-t))/2)},Xr=e=>{var i=180/Math.PI;return{lat:(2*Math.atan(Math.exp(e.y/_e))-Math.PI/2)*i,lng:e.x*i/_e}},Pr=(e,i)=>r=>{let t=ei(r);return new se.default((t.x+H)/(H*2),1-(t.y+H)/(H*2)).mult((1<<i)*256).sub(e)},Vr=(e,i)=>r=>{let t=new se.default(r.x,r.y).add(e).div((1<<i)*256),n=new se.default(t.x*(H*2)-H,(1-t.y)*(H*2)-H);return Xr(n)},gt=(e,i)=>{let r=i*(360/e);return Math.log2(r/256)},Gr=class{constructor(e){let i=e.dark?Ae:Ie;this.paint_rules=e.paint_rules||Re(i,e.shade),this.label_rules=e.label_rules||je(i,e.shade,e.language1,e.language2),this.backgroundColor=e.backgroundColor,this.views=Ot(e),this.debug=e.debug||"",this.xray=e.xray}drawContext(e,i,r,t,n){return Z(this,null,function*(){let s=ei(t),a=new se.default((s.x+H)/(H*2),1-(s.y+H)/(H*2)).clone().mult(Math.pow(2,n)*256).sub(new se.default(i/2,r/2)),l={minX:a.x,minY:a.y,maxX:a.x+i,maxY:a.y+r},f=[];for(let[S,d]of this.views){let m=d.getBbox(n,l);f.push({key:S,promise:m})}let u=yield Promise.all(f.map(S=>S.promise.then(d=>({status:"fulfilled",value:d,key:S.key}),d=>({status:"rejected",value:[],reason:d,key:S.key})))),c=new Map;for(let S of u)S.status==="fulfilled"&&c.set(S.key,S.value);let g=performance.now(),w=new qt(n,e,this.label_rules,16,void 0),x=w.add(c);this.backgroundColor&&(e.save(),e.fillStyle=this.backgroundColor,e.fillRect(0,0,i,r),e.restore());let _=this.paint_rules;this.xray&&(_=Qt(c,this.xray));let M=Ut(e,n,c,this.xray?null:w.index,_,l,a,!0,this.debug);if(this.debug){e.save(),e.translate(-a.x,-a.y),e.strokeStyle=this.debug,e.fillStyle=this.debug,e.font="12px sans-serif";let S=0;for(let[d,m]of c){for(let y of m){e.strokeRect(y.origin.x,y.origin.y,y.dim,y.dim);let z=y.data_tile;e.fillText(d+(d?" ":"")+z.z+" "+z.x+" "+z.y,y.origin.x+4,y.origin.y+14*(1+S))}S++}e.restore()}return{elapsed:performance.now()-g,project:Pr(a,n),unproject:Vr(a,n)}})}drawCanvas(e,i,r){return Z(this,arguments,function*(t,n,s,o={}){let a=window.devicePixelRatio,l=t.clientWidth,f=t.clientHeight;t.width==l*a&&t.height==f*a||(t.width=l*a,t.height=f*a),o.lang&&(t.lang=o.lang);let u=t.getContext("2d");return u.setTransform(a,0,0,a,0,0),this.drawContext(u,l,f,n,s)})}drawContextBounds(e,i,r,t,n){return Z(this,null,function*(){let s=r.x-i.x,o=new se.default((i.x+r.x)/2,(i.y+r.y)/2);return this.drawContext(e,t,n,o,gt(s,t))})}drawCanvasBounds(e,i,r,t){return Z(this,arguments,function*(n,s,o,a,l={}){let f=o.x-s.x,u=new se.default((s.x+o.x)/2,(s.y+o.y)/2);return this.drawCanvas(n,u,gt(f,a),l)})}},Ir=N(ne()),Ar=e=>new Promise((i,r)=>{setTimeout(()=>{i()},e)}),Rr=e=>e.then(i=>({status:"fulfilled",value:i}),i=>({status:"rejected",reason:i})),Qr=(e={})=>{class i extends L.GridLayer{constructor(t={}){t.noWrap&&!t.bounds&&(t.bounds=[[-90,-180],[90,180]]),t.attribution==null&&(t.attribution='<a href="https://protomaps.com">Protomaps</a> \xA9 <a href="https://openstreetmap.org/copyright">OpenStreetMap</a>'),super(t);let n=t.dark?Ae:Ie;this.paint_rules=t.paint_rules||Re(n,t.shade),this.label_rules=t.label_rules||je(n,t.shade,t.language1,t.language2),this.backgroundColor=t.backgroundColor,this.lastRequestedZ=void 0,this.xray=t.xray,this.tasks=t.tasks||[],this.views=Ot(t),this.debug=t.debug;let s=document.createElement("canvas").getContext("2d");this.scratch=s,this.onTilesInvalidated=o=>{o.forEach(a=>{this.rerenderTile(a)})},this.labelers=new st(this.scratch,this.label_rules,16,this.onTilesInvalidated),this.tile_size=256*window.devicePixelRatio,this.tileDelay=t.tileDelay||3,this.lang=t.lang,this.inspector=this.inspect(this)}setDefaultStyle(t,n,s,o){let a=t?Ae:Ie;this.paint_rules=Re(a,n),this.label_rules=je(a,n,s,o)}renderTile(t,n,s,o=()=>{}){return Z(this,null,function*(){this.lastRequestedZ=t.z;let a=[];for(let[b,F]of this.views){let T=F.getDisplayTile(t);a.push({key:b,promise:T})}let l=yield Promise.all(a.map(b=>b.promise.then(F=>({status:"fulfilled",value:F,key:b.key}),F=>({status:"rejected",reason:F,key:b.key})))),f=new Map;for(let b of l)b.status==="fulfilled"?f.set(b.key,[b.value]):b.reason.name==="AbortError"||console.error(b.reason);if(n.key!=s||this.lastRequestedZ!==t.z||(yield Promise.all(this.tasks.map(Rr)),n.key!=s)||this.lastRequestedZ!==t.z)return;let u=this.labelers.add(t.z,f);if(n.key!=s||this.lastRequestedZ!==t.z)return;let c=this.labelers.getIndex(t.z);if(!this._map)return;let g=this._map.getCenter().wrap(),w=this._getTiledPixelBounds(g),x=this._pxBoundsToTileRange(w),_=x.getCenter(),M=t.distanceTo(_)*this.tileDelay;if(yield Ar(M),n.key!=s||this.lastRequestedZ!==t.z)return;let S=16,d={minX:256*t.x-S,minY:256*t.y-S,maxX:256*(t.x+1)+S,maxY:256*(t.y+1)+S},m=new Ir.default(256*t.x,256*t.y);n.width=this.tile_size,n.height=this.tile_size;let y=n.getContext("2d");y.setTransform(this.tile_size/256,0,0,this.tile_size/256,0,0),y.clearRect(0,0,256,256),this.backgroundColor&&(y.save(),y.fillStyle=this.backgroundColor,y.fillRect(0,0,256,256),y.restore());var z=0;let k=this.paint_rules;if(this.xray&&(k=Qt(f,this.xray)),z=Ut(y,t.z,f,this.xray?null:c,k,d,m,!1,this.debug),this.debug){y.save(),y.fillStyle=this.debug,y.font="600 12px sans-serif",y.fillText(t.z+" "+t.x+" "+t.y,4,14),y.font="12px sans-serif";let b=28;for(let[F,T]of f){let B=T[0].data_tile;y.fillText(F+(F?" ":"")+B.z+" "+B.x+" "+B.y,4,b),b+=14}y.font="600 10px sans-serif",z>8&&(y.fillText(z.toFixed()+" ms paint",4,b),b+=14),u>8&&y.fillText(u.toFixed()+" ms layout",4,b),y.strokeStyle=this.debug,y.lineWidth=.5,y.beginPath(),y.moveTo(0,0),y.lineTo(0,256),y.stroke(),y.lineWidth=.5,y.beginPath(),y.moveTo(0,0),y.lineTo(256,0),y.stroke(),y.restore()}o()})}rerenderTile(t){for(let n in this._tiles){let s=this._wrapCoords(this._keyToTileCoords(n));t===this._tileCoordsToKey(s)&&this.renderTile(s,this._tiles[n].el,t)}}clearLayout(){this.labelers=new st(this.scratch,this.label_rules,16,this.onTilesInvalidated)}rerenderTiles(){for(let t in this._tiles){let n=this._wrapCoords(this._keyToTileCoords(t)),s=this._tileCoordsToKey(n);this.renderTile(n,this._tiles[t].el,s)}}createTile(t,n){let s=L.DomUtil.create("canvas","leaflet-tile");s.lang=this.lang;let o=this._tileCoordsToKey(t);return s.key=o,this.renderTile(t,s,o,()=>{n(null,s)}),s}_removeTile(t){let n=this._tiles[t];n&&(n.el.removed=!0,n.el.key=void 0,L.DomUtil.removeClass(n.el,"leaflet-tile-loaded"),n.el.width=n.el.height=0,L.DomUtil.remove(n.el),delete this._tiles[t],this.fire("tileunload",{tile:n.el,coords:this._keyToTileCoords(t)}))}queryFeatures(t,n){let s=new Map;for(var[o,a]of this.views)s.set(o,a.queryFeatures(t,n,this._map.getZoom()));return s}inspect(t){return n=>{let s=["\u25CE","\u27CD","\u25FB"],o=t._map.wrapLatLng(n.latlng),a=t.queryFeatures(o.lng,o.lat);var l="";let f=!0;for(var[u,c]of a)for(var g of c)if(!(this.xray&&this.xray!==!0&&!((this.xray.dataSource||"")===u&&this.xray.dataLayer===g.layerName))){l=l+`<div style="margin-top:${f?0:.5}em">${s[g.feature.geomType-1]} <b>${u} ${u?"/":""} ${g.layerName}</b> ${g.feature.id||""}</div>`;for(let w in g.feature.props)l=l+`<div style="font-size:0.9em">${w} = ${g.feature.props[w]}</div>`;f=!1}f&&(l="No features."),L.popup().setLatLng(n.latlng).setContent('<div style="max-height:400px;overflow-y:scroll;padding-right:8px">'+l+"</div>").openOn(t._map)}}addInspector(t){return t.on("click",this.inspector)}removeInspector(t){return t.off("click",this.inspector)}}return new i(e)};function jr(e){let i=0,r=0;for(let a of e)i+=a.w*a.h,r=Math.max(r,a.w);e.sort((a,l)=>l.h-a.h);let n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),r),h:1/0}],s=0,o=0;for(let a of e)for(let l=n.length-1;l>=0;l--){let f=n[l];if(!(a.w>f.w||a.h>f.h)){if(a.x=f.x,a.y=f.y,o=Math.max(o,a.y+a.h),s=Math.max(s,a.x+a.w),a.w===f.w&&a.h===f.h){let u=n.pop();l<n.length&&(n[l]=u)}else a.h===f.h?(f.x+=a.w,f.w-=a.w):a.w===f.w?(f.y+=a.h,f.h-=a.h):(n.push({x:f.x+a.w,y:f.y,w:f.w-a.w,h:a.h}),f.y+=a.h,f.h-=a.h);break}}return{w:s,h:o,fill:i/(s*o)||0}}var en=(e,i,r)=>{let t=new FontFace(e,"url("+i+")",{weight:r});return document.fonts.add(t),t.load()},vt=e=>Z(void 0,null,function*(){return new Promise((i,r)=>{let t=new Image;t.onload=()=>i(t),t.onerror=()=>r("Invalid SVG"),t.src=e})}),Or=`
<svg width="20px" height="20px" viewBox="0 0 50 50" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <rect width="50" height="50" fill="#cccccc"/>
    <g transform="translate(5,5)">
        <path fill="none" stroke="#666666" stroke-width="7" d="m11,12a8.5,8 0 1,1 17,0q0,4-4,6t-4.5,4.5-.4,4v.2m0,3v7"/>
    </g>
</svg>
`,tn=class{constructor(e){this.src=e,this.canvas=document.createElement("canvas"),this.mapping=new Map,this.missingBox={x:0,y:0,w:0,h:0}}load(){return Z(this,null,function*(){let e=this.src,i=window.devicePixelRatio;e.endsWith(".html")&&(e=yield(yield fetch(e)).text());let r=new window.DOMParser().parseFromString(e,"text/html"),t=Array.from(r.body.children),n=yield vt("data:image/svg+xml;base64,"+btoa(Or)),s=[{w:n.width*i,h:n.height*i,img:n,id:""}],o=new XMLSerializer;for(let c of t){var a=btoa(o.serializeToString(c)),l="data:image/svg+xml;base64,"+a;let g=yield vt(l);s.push({w:g.width*i,h:g.height*i,img:g,id:c.id})}let f=jr(s);this.canvas.width=f.w,this.canvas.height=f.h;let u=this.canvas.getContext("2d");if(u)for(let c of s)c.x!==void 0&&c.y!==void 0&&(u.drawImage(c.img,c.x,c.y,c.w,c.h),c.id?this.mapping.set(c.id,{x:c.x,y:c.y,w:c.w,h:c.h}):this.missingBox={x:c.x,y:c.y,w:c.w,h:c.h});return this})}get(e){let i=this.mapping.get(e);return i||(i=this.missingBox),i}};function Fe(e,i){return typeof e=="number"?e:i}function Se(e){if(e.includes("$type"))return i=>!0;if(e[0]=="==")return(i,r)=>r.props[e[1]]===e[2];if(e[0]=="!=")return(i,r)=>r.props[e[1]]!==e[2];if(e[0]=="!"){let i=Se(e[1]);return(r,t)=>!i(r,t)}else{if(e[0]==="<")return(i,r)=>Fe(r.props[e[1]],1/0)<e[2];if(e[0]==="<=")return(i,r)=>Fe(r.props[e[1]],1/0)<=e[2];if(e[0]===">")return(i,r)=>Fe(r.props[e[1]],-1/0)>e[2];if(e[0]===">=")return(i,r)=>Fe(r.props[e[1]],-1/0)>=e[2];if(e[0]==="in")return(i,r)=>e.slice(2,e.length).includes(r.props[e[1]]);if(e[0]==="!in")return(i,r)=>!e.slice(2,e.length).includes(r.props[e[1]]);if(e[0]==="has")return(i,r)=>r.props.hasOwnProperty(e[1]);if(e[0]==="!has")return(i,r)=>!r.props.hasOwnProperty(e[1]);if(e[0]==="all"){let i=e.slice(1,e.length).map(r=>Se(r));return(r,t)=>i.every(n=>n(r,t))}else if(e[0]==="any"){let i=e.slice(1,e.length).map(r=>Se(r));return(r,t)=>i.some(n=>n(r,t))}else return console.log("Unimplemented filter: ",e[0]),i=>!1}}function Oe(e){if(e.base&&e.stops)return r=>Q(e.base,e.stops)(r-1);if(e[0]=="interpolate"&&e[1][0]=="exponential"&&e[2]=="zoom"){let r=e.slice(3),t=[];for(var i=0;i<r.length;i+=2)t.push([r[i],r[i+1]]);return n=>Q(e[1][1],t)(n-1)}else if(e[0]=="step"&&e[1][0]=="get"){let r=e.slice(2),t=e[1][1];return(n,s)=>{let o=s?.props[t];if(typeof o=="number"){if(o<r[1])return r[0];for(i=1;i<r.length;i+=2)if(o<=r[i])return r[i+1]}return r[r.length-1]}}else return console.log("Unimplemented numeric fn: ",e),r=>1}function wt(e,i=0){return e?typeof e=="number"?e:(r,t)=>t?Oe(e)(r,t):i:i}function xt(e,i){let r=wt(e,1),t=wt(i);return(n,s)=>{let o=typeof r=="number"?r:r(n,s);return t?o+(typeof t=="number"?t:t(n,s)):o}}function _t(e,i){let r=[];for(let a of e["text-font"])i.hasOwnProperty(a)&&r.push(i[a]);r.length===0&&r.push({face:"sans-serif"});let t=e["text-size"];var n="";r.length&&r[0].weight&&(n=r[0].weight+" ");var s="";if(r.length&&r[0].style&&(s=r[0].style+" "),typeof t=="number")return a=>`${s}${n}${t}px ${r.map(l=>l.face).join(", ")}`;if(t.stops){var o=1.4;t.base?o=t.base:t.base=o;let a=Oe(t);return(l,f)=>`${s}${n}${a(l,f)}px ${r.map(u=>u.face).join(", ")}`}else if(t[0]=="step"){let a=Oe(t);return(l,f)=>`${s}${n}${a(l,f)}px ${r.map(u=>u.face).join(", ")}`}else return console.log("Can't parse font: ",e),a=>"12px sans-serif"}function rn(e,i){let r=[],t=[],n=new Map;for(var s of e.layers){if(n.set(s.id,s),s.layout&&s.layout.visibility=="none")continue;if(s.ref){let f=n.get(s.ref);s.type=f.type,s.filter=f.filter,s.source=f.source,s["source-layer"]=f["source-layer"]}let l=s["source-layer"];var o,a=void 0;s.filter&&(a=Se(s.filter)),s.type=="fill"?r.push({dataLayer:s["source-layer"],filter:a,symbolizer:new j({fill:s.paint["fill-color"],opacity:s.paint["fill-opacity"]})}):s.type=="fill-extrusion"?r.push({dataLayer:s["source-layer"],filter:a,symbolizer:new j({fill:s.paint["fill-extrusion-color"],opacity:s.paint["fill-extrusion-opacity"]})}):s.type=="line"?s.paint["line-dasharray"]?r.push({dataLayer:s["source-layer"],filter:a,symbolizer:new W({width:xt(s.paint["line-width"],s.paint["line-gap-width"]),dash:s.paint["line-dasharray"],dashColor:s.paint["line-color"]})}):r.push({dataLayer:s["source-layer"],filter:a,symbolizer:new W({color:s.paint["line-color"],width:xt(s.paint["line-width"],s.paint["line-gap-width"])})}):s.type=="symbol"?s.layout["symbol-placement"]=="line"?t.push({dataLayer:s["source-layer"],filter:a,symbolizer:new Jt({font:_t(s.layout,i),fill:s.paint["text-color"],width:s.paint["text-halo-width"],stroke:s.paint["text-halo-color"],textTransform:s.layout["text-transform"],label_props:s.layout["text-field"]?[s.layout["text-field"]]:void 0})}):t.push({dataLayer:s["source-layer"],filter:a,symbolizer:new ue({font:_t(s.layout,i),fill:s.paint["text-color"],stroke:s.paint["text-halo-color"],width:s.paint["text-halo-width"],textTransform:s.layout["text-transform"],label_props:s.layout["text-field"]?[s.layout["text-field"]]:void 0})}):s.type=="circle"&&r.push({dataLayer:s["source-layer"],filter:a,symbolizer:new Ce({radius:s.paint["circle-radius"],fill:s.paint["circle-color"],stroke:s.paint["circle-stroke-color"],width:s.paint["circle-stroke-width"]})})}return t.reverse(),{paint_rules:r,label_rules:t,tasks:[]}}export{Yr as CenteredSymbolizer,ue as CenteredTextSymbolizer,Ce as CircleSymbolizer,dt as FlexSymbolizer,en as Font,ce as GeomType,ct as GroupSymbolizer,Kr as IconSymbolizer,mr as Index,ft as Justify,qt as Labeler,st as Labelers,pt as LineLabelPlacement,Jt as LineLabelSymbolizer,W as LineSymbolizer,Er as OffsetSymbolizer,Me as OffsetTextSymbolizer,er as PMTiles,Jr as Padding,tt as PmtilesSource,Ee as PolygonLabelSymbolizer,j as PolygonSymbolizer,tn as Sheet,Br as ShieldSymbolizer,Gr as Static,ut as TextPlacements,Ne as TextSymbolizer,hr as TileCache,fr as View,ir as ZxySource,Nr as arr,pr as covering,$r as createPattern,Hr as cubicBezier,Ae as dark,Q as exp,Se as filterFn,_t as getFont,gt as getZoom,sr as isCCW,nt as isInRing,rn as json_style,je as labelRules,Qr as leafletLayer,Ie as light,Zr as linear,Oe as numberFn,wt as numberOrFn,Re as paintRules,Ut as painter,ar as pointInPolygon,lr as pointMinDistToLines,or as pointMinDistToPoints,Ot as sourcesToViews,Wr as step,le as toIndex,jt as transformGeom,xt as widthFn,ke as wrap};
//# sourceMappingURL=protomaps.module-RHZ4APKW.js.map
